<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Club Recrear</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Paleta basada en el Login */
            --brand-dark: #0d3b4c;       /* Fondo oscuro sidebar */
            --brand-primary: #009CB4;    /* Cian principal */
            --brand-blue: #0065B7;       /* Azul secundario */
            --brand-gradient: linear-gradient(135deg, var(--brand-blue) 0%, var(--brand-primary) 100%);
            
            --bg-body: #f0f2f5;          /* Gris muy suave de fondo */
            --text-dark: #343a40;
            --text-muted: #6c757d;
        }

        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--brand-dark); /* Fondo general oscuro para dar contraste al main */
        }

        /* Desktop: sin scroll en body (el main-wrapper tiene scroll interno) */
        @media (min-width: 768px) {
            html, body {
                overflow: hidden;
            }
        }

        /* Móvil: scroll normal en body */
        @media (max-width: 767.98px) {
            html, body {
                overflow-y: auto;
                height: auto;
                min-height: 100%;
            }
        }

        /* --- NAVBAR SUPERIOR (Móvil) --- */
        .navbar-top {
            background: linear-gradient(135deg, var(--brand-dark) 0%, rgba(13, 59, 76, 0.95) 100%);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-logo {
            height: 35px;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            /* background: var(--brand-dark); */
            color: #fff;
            position: relative;
            z-index: 10;
        }

        /* Ajuste del sidebar en resoluciones medianas (768px - 992px) */
        @media (min-width: 768px) and (max-width: 991.98px) {
            .sidebar {
                flex: 0 0 200px !important;
                max-width: 200px !important;
                min-width: 200px !important;
            }
            .sidebar .nav-link {
                font-size: 0.85rem;
                padding: 10px 12px;
            }
            .sidebar .logo-container img {
                max-width: 100%;
                height: auto;
            }
            .sidebar .sidebar-section {
                padding: 10px;
            }
            .sidebar .ticket-history-item {
                padding: 8px;
            }
            .sidebar .ticket-history-title {
                font-size: 0.75rem;
            }
            .columna-cont {
                flex: 1 !important;
                max-width: calc(100% - 200px) !important;
            }
        }

        .logo-container {
            padding: 0rem 1.5rem;
            margin-bottom: 1rem;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.75);
            font-weight: 500;
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px; /* Espacio entre icono y texto */
        }

        .nav-link i {
            font-size: 1.2rem;
        }

        .nav-link:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        /* Estilo para el botón activo (Home) */
        .nav-link.active {
            background: var(--brand-gradient);
            color: #fff !important;
            box-shadow: 0 4px 15px rgba(0, 156, 180, 0.4);
            font-weight: 600;
        }

        /* Botón de Logout */
        .btn-logout {
            margin-top: auto; /* Empuja el botón al fondo si usas flex column */
            background: rgba(220, 53, 69, 0.15);
            color: #ff6b6b;
            border: 1px solid rgba(220, 53, 69, 0.3);
        }
        .btn-logout:hover {
            background: rgba(220, 53, 69, 0.9);
            color: #fff;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        /* Secciones extra del sidebar (Filtros, etc) */
        .sidebar-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.9rem;
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* --- MAIN CONTENT AREA --- */
        .main-wrapper {
            background-color: #F5F7FA;
            border-radius: 30px 0 0 30px; /* Curva solo a la izquierda */
            height: 100vh;
            overflow-y: auto; /* Scroll interno para el contenido */
            padding: 2rem;
            box-shadow: -10px 0 30px rgba(0,0,0,0.2);
            position: relative;
        }

        @media (max-width: 767.98px) {
            .main-wrapper {
                border-radius: 0;
                padding: 1rem;
                padding-bottom: 180px; /* Aumentado para mobile nav + FAB + contenido */
                min-height: 100vh;
                height: auto;
                margin-bottom: 0;
                overflow-y: visible;
            }
        }

        /* --- METRIC CARDS (KPIs) --- */
        .kpi-card {
            background: #fff;
            border: none;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
            height: 100%;
            display: flex;
            align-items: center;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
        }

        /* Colores específicos para iconos */
        .icon-blue { background: rgba(0, 101, 183, 0.1); color: var(--brand-blue); }
        .icon-teal { background: rgba(0, 156, 180, 0.1); color: var(--brand-primary); }
        .icon-purple { background: rgba(111, 66, 193, 0.1); color: #6f42c1; }

        .kpi-title {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
            font-weight: 600;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--brand-blue);
            line-height: 1;
        }
        
        /* Títulos importantes con gradiente azul */
        .title-gradient {
            background: linear-gradient(135deg, var(--brand-blue), var(--brand-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .text-brand-blue {
            color: var(--brand-blue);
        }
        .row-principal{
            background-color: var(--brand-dark);
        }
        
        @media (max-width: 767.98px) {
            .row-principal {
                height: auto !important;
                min-height: 100vh;
            }
            
            .container-fluid.h-100 {
                height: auto !important;
                min-height: 100vh;
            }
        }
        
        .columna-cont{
            background-color: var(--brand-dark);
        }
        
        /* En móvil, igualar el fondo con el navbar */
        @media (max-width: 767.98px) {
            .columna-cont,
            .row-principal {
                background: linear-gradient(135deg, var(--brand-dark) 0%, rgba(13, 59, 76, 0.95) 100%);
            }
        }

        /* --- CHAT STYLES --- */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 4rem);
            background: #fff;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        @media (max-width: 767.98px) {
            .chat-container {
                border-radius: 0;
                height: 100dvh;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 1000;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(0, 101, 183, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px 20px 0 0;
        }

        @media (max-width: 767.98px) {
            .chat-header {
                padding: 1rem;
                border-radius: 0;
            }
            .chat-header h5 {
                font-size: 1rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            .chat-header small {
                font-size: 0.75rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                display: block;
                max-width: 100%;
            }
            .chat-header .flex-grow-1 {
                min-width: 0;
                overflow: hidden;
            }
        }

        .chat-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--brand-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        @media (max-width: 767.98px) {
            .chat-user-avatar {
                display: none;
            }
            .chat-header .d-flex.gap-2 {
                flex-shrink: 0;
            }
            .chat-header .badge {
                white-space: nowrap;
            }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        @media (max-width: 767.98px) {
            .chat-messages {
                padding: 1rem 0.75rem;
            }
        }

        .message-wrapper {
            display: flex;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mensajes del usuario (derecha) */
        .user-message {
            justify-content: flex-end;
        }

        .user-message .message-content {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            max-width: 70%;
        }

        .user-message .message-bubble {
            background: var(--brand-gradient);
            color: white;
            padding: 0.85rem 1.2rem;
            border-radius: 18px 18px 4px 18px;
            max-width: 100%;
            box-shadow: 0 4px 12px rgba(0, 101, 183, 0.2);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        @media (max-width: 767.98px) {
            .user-message .message-content {
                max-width: 85%;
            }
            
            .user-message .message-bubble {
                padding: 0.75rem 1rem;
            }
        }

        .user-message .message-bubble p {
            margin: 0;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Mensajes del soporte (izquierda) */
        .support-message {
            justify-content: flex-start;
        }

        .support-message .message-content {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            max-width: 70%;
        }

        .support-message .message-bubble {
            background: #fff;
            color: #333;
            padding: 0.85rem 1.2rem;
            border-radius: 18px 18px 18px 4px;
            max-width: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid rgba(0, 101, 183, 0.08);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        @media (max-width: 767.98px) {
            .support-message .message-content {
                max-width: 85%;
            }
            
            .support-message .message-bubble {
                padding: 0.75rem 1rem;
            }
        }

        .support-message .message-bubble p {
            margin: 0;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: rgba(0, 156, 180, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--brand-primary);
            font-size: 1.1rem;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }

        .message-time {
            color: #6c757d;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Input del chat */
        .chat-input {
            background: #fff;
            padding: 1rem 1.5rem;
            border-top: 1px solid rgba(0, 101, 183, 0.1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        @media (max-width: 767.98px) {
            .chat-input {
                padding: 0.75rem 1rem;
                padding-bottom: max(0.75rem, env(safe-area-inset-bottom));
            }
        }

        .chat-input input {
            background: #f8f9fa;
            padding: 0.75rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .chat-input input:focus {
            background: #fff;
            box-shadow: 0 0 0 3px rgba(0, 156, 180, 0.1);
        }

        /* Scrollbar personalizada */
        .chat-messages::-webkit-scrollbar,
        .tickets-history::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track,
        .tickets-history::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb,
        .tickets-history::-webkit-scrollbar-thumb {
            background: rgba(0, 156, 180, 0.6);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover,
        .tickets-history::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 101, 183, 0.8);
            border: 2px solid transparent;
            background-clip: padding-box;
        }

        /* Asegurar que el scrollbar siempre sea visible */
        .tickets-history {
            overflow-y: auto !important;
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 156, 180, 0.6) rgba(255, 255, 255, 0.08);
        }
        
        /* Forzar visibilidad del scrollbar en webkit */
        .tickets-history::-webkit-scrollbar {
            display: block !important;
        }

        /* --- TICKETS HISTORY SIDEBAR --- */
        .ticket-history-item {
            padding: 0.65rem 0.75rem;
            margin-bottom: 0.4rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .ticket-history-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(3px);
        }

        .ticket-history-item.active {
            background: var(--brand-gradient);
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(0, 156, 180, 0.3);
        }

        .ticket-history-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            min-width: 0;
            padding-right: 0.5rem;
        }

        .ticket-history-badge {
            background: var(--brand-primary);
            color: white;
            font-size: 0.7rem;
            padding: 0.15rem 0.45rem;
            border-radius: 10px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        /* --- OFFCANVAS STYLES --- */
        .offcanvas {
            background: #fff;
        }

        .offcanvas-header {
            background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));
        }

        /* Participantes */
        .participant-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .participant-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .participant-item:hover {
            background: rgba(0, 101, 183, 0.05);
            transform: translateX(3px);
        }

        .participant-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        /* Archivos adjuntos */
        .attachment-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 1rem 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .attachment-item:hover {
            background: rgba(0, 101, 183, 0.05);
            border-color: var(--brand-blue);
            transform: translateY(-2px);
        }

        .attachment-item i {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .attachment-item small {
            font-size: 0.7rem;
        }

        /* --- MOBILE BOTTOM NAVIGATION --- */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            box-shadow: 0 -2px 15px rgba(0,0,0,0.08);
            z-index: 100;
            padding: 0.25rem 0;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        /* Móvil: hasta 767.98px (Bootstrap md empieza en 768px) */
        @media (max-width: 767.98px) {
            .mobile-bottom-nav {
                display: flex;
                justify-content: space-around;
                align-items: center;
            }

            .sidebar {
                display: none !important;
            }

            .columna-cont {
                flex: 0 0 100% !important;
                max-width: 100% !important;
                height: auto !important;
            }
            
            .col.h-100 {
                height: auto !important;
            }
            
            .row.h-100 {
                height: auto !important;
                min-height: 100vh;
            }
            
            #chatBackButton {
                display: inline-flex !important;
                position: relative;
                z-index: 2;
            }
        }
        
        /* Desktop: desde 768px */
        @media (min-width: 768px) {
            .mobile-bottom-nav {
                display: none !important;
            }

            #chatBackButton {
                display: none !important;
            }
        }

        .mobile-nav-item {
            flex: 1;
            text-align: center;
            padding: 0.3rem 0.25rem;
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.1rem;
            cursor: pointer;
            background: none;
            border: none;
        }

        .mobile-nav-item i {
            font-size: 1.5rem;
        }

        .mobile-nav-item span {
            font-size: 0.6rem;
            font-weight: 500;
        }

        .mobile-nav-item.active {
            color: var(--brand-blue);
        }

        /* --- TICKETS LIST VIEW (WhatsApp style) --- */
        .tickets-list {
            display: none;
        }

        @media (max-width: 767.98px) {
            .tickets-list {
                display: block;
            }

            .tickets-list-item {
                display: flex;
                align-items: center;
                padding: 1rem;
                border-bottom: 1px solid #f0f0f0;
                cursor: pointer;
                transition: background 0.2s ease;
            }

            .tickets-list-item:hover,
            .tickets-list-item:active {
                background: rgba(0, 101, 183, 0.05);
            }

            .ticket-avatar {
                width: 50px;
                height: 50px;
                border-radius: 50%;
                background: var(--brand-gradient);
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1.5rem;
                margin-right: 1rem;
                flex-shrink: 0;
            }

            .ticket-info {
                flex: 1;
                min-width: 0;
            }

            .ticket-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.25rem;
            }

            .ticket-title {
                font-weight: 600;
                color: var(--brand-blue);
                font-size: 0.95rem;
                margin: 0;
            }

            .ticket-time {
                font-size: 0.75rem;
                color: var(--text-muted);
            }

            .ticket-preview {
                color: var(--text-muted);
                font-size: 0.85rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 100%;
            }

            .ticket-title {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .ticket-badge {
                display: inline-block;
                min-width: 20px;
                height: 20px;
                background: var(--brand-primary);
                color: white;
                border-radius: 10px;
                font-size: 0.7rem;
                text-align: center;
                line-height: 20px;
                padding: 0 0.4rem;
                margin-left: 0.5rem;
            }
        }

        /* --- FLOATING ACTION BUTTON --- */
        .fab {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--brand-gradient);
            color: white;
            border: none;
            box-shadow: 0 4px 20px rgba(0, 101, 183, 0.4);
            font-size: 1.5rem;
            z-index: 99;
            transition: transform 0.2s ease;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* --- BADGE NOTIFICACIONES --- */
        .notification-badge {
            position: relative;
            cursor: pointer;
        }

        .notification-badge .badge-counter {
            position: absolute;
            top: -5px;
            right: -5px;
            min-width: 18px;
            height: 18px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            font-size: 0.65rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            border: 2px solid var(--brand-dark);
            animation: pulse-badge 2s infinite;
        }

        @keyframes pulse-badge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* --- PANEL DE SOLICITUDES --- */
        .offcanvas-solicitudes {
            width: 420px !important;
        }

        @media (max-width: 767.98px) {
            .offcanvas-solicitudes {
                width: 100% !important;
            }
        }

        .solicitud-card {
            background: white;
            border-radius: 16px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(0,0,0,0.08);
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: all 0.2s ease;
        }

        .solicitud-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .solicitud-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 0.75rem;
        }

        .solicitud-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--brand-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .solicitud-info {
            flex: 1;
            min-width: 0;
        }

        .solicitud-titulo {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .solicitud-usuario {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0;
        }

        .solicitud-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 0.75rem;
        }

        .solicitud-descripcion {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .solicitud-acciones {
            display: flex;
            gap: 8px;
        }

        .btn-aceptar {
            flex: 1;
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .btn-aceptar:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.35);
            color: white;
        }

        .btn-rechazar {
            flex: 1;
            background: linear-gradient(135deg, #dc3545, #e74c3c);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .btn-rechazar:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.35);
            color: white;
        }

        .btn-ver-detalle {
            background: transparent;
            border: 1px solid rgba(0,0,0,0.1);
            color: var(--text-muted);
            padding: 8px;
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .btn-ver-detalle:hover {
            background: rgba(0,0,0,0.05);
            color: var(--brand-blue);
        }

        .prioridad-critica { background: linear-gradient(135deg, #e74c3c, #c0392b) !important; color: white !important; }
        .prioridad-alta { background: linear-gradient(135deg, #e67e22, #d35400) !important; color: white !important; }
        .prioridad-media { background: linear-gradient(135deg, #f1c40f, #f39c12) !important; color: #000 !important; }
        .prioridad-baja { background: linear-gradient(135deg, var(--brand-primary), #20c997) !important; color: white !important; }

        .solicitudes-empty {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
        }

        .solicitudes-empty i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Badge para nav móvil de solicitudes */
        .mobile-nav-badge {
            position: absolute;
            top: 2px;
            right: 50%;
            transform: translateX(15px);
            min-width: 16px;
            height: 16px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            font-size: 0.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 3px;
        }

        /* === SISTEMA DE NOTIFICACIONES === */
        .notifications-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 380px;
            max-height: calc(100vh - 120px);
            z-index: 1200;
            display: none;
        }

        @media (max-width: 767.98px) {
            .notifications-panel {
                width: calc(100% - 20px);
                right: 10px;
                left: 10px;
                top: 60px;
                max-height: calc(100vh - 140px);
            }
        }

        .notifications-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 101, 183, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: inherit;
        }

        .notifications-header {
            background: var(--brand-gradient);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notifications-list {
            flex: 1;
            overflow-y: auto;
            max-height: 300px;
        }

        @media (max-width: 767.98px) {
            .notifications-list {
                max-height: calc(100vh - 280px);
            }
        }

        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: rgba(0, 156, 180, 0.05);
        }

        .notification-item.unread {
            background: rgba(0, 156, 180, 0.08);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-icon.new-ticket { background: var(--brand-gradient); color: white; }
        .notification-icon.response { background: linear-gradient(135deg, var(--brand-primary), #20c997); color: white; }
        .notification-icon.urgent { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        .notification-icon.assigned { background: linear-gradient(135deg, var(--brand-blue), var(--brand-primary)); color: white; }
        .notification-icon.closed { background: linear-gradient(135deg, var(--brand-dark), #1a5a6e); color: white; }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-dark);
            margin-bottom: 2px;
        }

        .notification-text {
            font-size: 0.8rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .notification-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .notification-badge-btn {
            position: relative;
            background: transparent;
            border: none;
            padding: 8px;
            cursor: pointer;
        }

        .notification-badge-btn .badge-count {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 18px;
            height: 18px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            font-size: 0.65rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse-badge 2s infinite;
        }

        /* === MÉTRICAS Y GRÁFICOS === */
        .metric-card {
            background: white;
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 4px 15px rgba(0, 101, 183, 0.08);
            height: 100%;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            box-shadow: 0 8px 25px rgba(0, 101, 183, 0.15);
            transform: translateY(-2px);
        }

        .metric-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--brand-blue);
        }

        .metric-change {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 20px;
            white-space: nowrap;
        }

        .metric-change.positive { background: rgba(0, 156, 180, 0.15); color: var(--brand-primary); }
        .metric-change.negative { background: rgba(231, 76, 60, 0.15); color: #e74c3c; }

        /* Contenedor de badges de prioridad en metric card */
        .metric-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 0.5rem;
        }

        .metric-badges .badge {
            font-size: 0.65rem;
            padding: 3px 6px;
            white-space: nowrap;
        }

        @media (max-width: 767.98px) {
            .metric-card {
                padding: 1rem;
            }
            .metric-value {
                font-size: 1.5rem;
            }
            .metric-card-header span.text-muted {
                font-size: 0.75rem;
            }
            .metric-badges .badge {
                font-size: 0.6rem;
                padding: 2px 5px;
            }
        }

        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .mini-chart {
            height: 60px;
            display: flex;
            align-items: flex-end;
            gap: 4px;
        }

        .chart-bar {
            flex: 1;
            background: var(--brand-gradient);
            border-radius: 4px 4px 0 0;
            transition: height 0.3s ease;
        }

        /* === RESPUESTAS PREDEFINIDAS === */
        .quick-replies-panel {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 16px 16px 0 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 100;
        }

        .quick-replies-panel.show {
            display: block;
        }

        .quick-reply-item {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            cursor: pointer;
            transition: background 0.2s;
        }

        .quick-reply-item:hover {
            background: rgba(0, 156, 180, 0.05);
        }

        .quick-reply-title {
            font-weight: 600;
            color: var(--brand-blue);
            font-size: 0.9rem;
        }

        .quick-reply-preview {
            font-size: 0.8rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* === BASE DE CONOCIMIENTO === */
        .kb-card {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            border: 1px solid rgba(0,0,0,0.08);
            transition: all 0.2s ease;
            cursor: pointer;
            height: 100%;
        }

        .kb-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-color: var(--brand-primary);
        }

        .kb-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .kb-icon.tech { background: linear-gradient(135deg, rgba(0, 101, 183, 0.1), rgba(0, 156, 180, 0.1)); color: var(--brand-blue); }
        .kb-icon.account { background: linear-gradient(135deg, rgba(13, 59, 76, 0.1), rgba(0, 101, 183, 0.1)); color: var(--brand-dark); }
        .kb-icon.payments { background: linear-gradient(135deg, rgba(0, 156, 180, 0.1), rgba(32, 201, 151, 0.1)); color: var(--brand-primary); }
        .kb-icon.general { background: linear-gradient(135deg, rgba(230, 126, 34, 0.1), rgba(241, 196, 15, 0.1)); color: #e67e22; }

        .kb-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .kb-count {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* === HISTORIAL Y AUDITORÍA === */
        .audit-timeline {
            position: relative;
            padding-left: 30px;
        }

        .audit-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--brand-primary), var(--brand-blue));
        }

        .audit-item {
            position: relative;
            padding-bottom: 20px;
        }

        .audit-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--brand-primary);
            border: 3px solid white;
            box-shadow: 0 0 0 2px var(--brand-primary);
        }

        .audit-item.action-create::before { background: var(--brand-primary); box-shadow: 0 0 0 2px var(--brand-primary); }
        .audit-item.action-update::before { background: var(--brand-blue); box-shadow: 0 0 0 2px var(--brand-blue); }
        .audit-item.action-assign::before { background: var(--brand-dark); box-shadow: 0 0 0 2px var(--brand-dark); }
        .audit-item.action-close::before { background: #6c757d; box-shadow: 0 0 0 2px #6c757d; }
        .audit-item.action-reopen::before { background: #e67e22; box-shadow: 0 0 0 2px #e67e22; }

        .audit-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .audit-action {
            font-weight: 600;
            color: var(--text-dark);
        }

        .audit-user {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .audit-details {
            font-size: 0.8rem;
            color: var(--text-muted);
            background: rgba(0, 101, 183, 0.05);
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 8px;
        }

        /* === ESTILOS RESPONSIVE GENERALES === */
        @media (max-width: 767.98px) {
            .main-wrapper {
                padding: 1rem;
                border-radius: 20px 20px 0 0;
            }
            
            .kpi-card {
                padding: 1rem;
            }
            
            .kpi-value {
                font-size: 1.25rem;
            }
            
            .kpi-title {
                font-size: 0.75rem;
            }
            
            .kpi-icon {
                width: 40px;
                height: 40px;
            }
            
            .kpi-icon i {
                font-size: 1rem;
            }
            
            .card.rounded-4 {
                border-radius: 12px !important;
            }
            
            .card.p-4 {
                padding: 1rem !important;
            }
            
            h2.title-gradient {
                font-size: 1.5rem;
            }
            
            h5.fw-bold {
                font-size: 1rem;
            }
            
            .kb-card {
                padding: 0.75rem;
            }
            
            .kb-icon {
                width: 40px;
                height: 40px;
                font-size: 1.25rem;
                margin-bottom: 0.5rem;
            }
            
            .kb-title {
                font-size: 0.85rem;
            }
            
            .kb-count {
                font-size: 0.7rem;
            }
            
            .mini-chart {
                height: 40px;
            }
            
            .table-responsive {
                font-size: 0.8rem;
            }
            
            .audit-timeline {
                padding-left: 25px;
            }
            
            .audit-item::before {
                width: 10px;
                height: 10px;
                left: -20px;
            }
        }

        /* === TOASTS ESTANDARIZADOS === */
        .toast-success {
            background: linear-gradient(135deg, var(--brand-primary), #20c997) !important;
        }
        
        .toast-error {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
        }
        
        .toast-info {
            background: var(--brand-gradient) !important;
        }
        
        .toast-warning {
            background: linear-gradient(135deg, #e67e22, #d35400) !important;
        }

        /* === BOTONES ESTANDARIZADOS === */
        .btn-brand {
            background: var(--brand-gradient);
            border: none;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-brand:hover {
            box-shadow: 0 4px 15px rgba(0, 101, 183, 0.35);
            transform: translateY(-1px);
            color: white;
        }
        
        .btn-outline-brand {
            border: 2px solid var(--brand-primary);
            color: var(--brand-primary);
            background: transparent;
            transition: all 0.3s ease;
        }
        
        .btn-outline-brand:hover {
            background: var(--brand-gradient);
            border-color: transparent;
            color: white;
        }

        /* === FORMULARIOS ESTANDARIZADOS === */
        
        /* Switch/Toggle con colores de marca */
        .form-check-input:checked {
            background-color: var(--brand-primary);
            border-color: var(--brand-primary);
        }
        
        .form-check-input:focus {
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 0.25rem rgba(0, 156, 180, 0.25);
        }
        
        .form-switch .form-check-input:checked {
            background-color: var(--brand-primary);
            border-color: var(--brand-primary);
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e");
        }
        
        .form-switch .form-check-input {
            width: 3em;
            height: 1.5em;
            background-color: #dee2e6;
            border: none;
            transition: all 0.3s ease;
            margin-left: 0;
            margin-top: 0;
            flex-shrink: 0;
            cursor: pointer;
        }
        
        .form-switch .form-check-input:focus {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='rgba%280, 156, 180, 0.5%29'/%3e%3c/svg%3e");
        }
        
        /* Alineación correcta de switches */
        .form-check.form-switch {
            padding-left: 0;
            min-height: auto;
        }
        
        .form-check.form-switch .form-check-label {
            cursor: pointer;
        }

        /* === SCROLL EN MÓVIL PARA TABS === */
        @media (max-width: 767.98px) {
            .tab-content {
                padding-bottom: 80px;
            }
            
            .tab-pane {
                padding-bottom: 20px;
            }
            
            #config {
                padding-bottom: 100px;
            }
        }

        /* Select con colores de marca */
        .form-select:focus {
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 0.25rem rgba(0, 156, 180, 0.25);
        }
        
        .form-select {
            border-radius: 12px;
            padding: 0.75rem 1rem;
            border: 1px solid #dee2e6;
            transition: all 0.3s ease;
        }

        /* Input con colores de marca */
        .form-control:focus {
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 0.25rem rgba(0, 156, 180, 0.25);
        }

        /* Botones outline Bootstrap con colores de marca */
        .btn-outline-primary {
            color: var(--brand-blue);
            border-color: var(--brand-blue);
        }
        
        .btn-outline-primary:hover,
        .btn-outline-primary:focus,
        .btn-outline-primary:active,
        .btn-outline-primary.active {
            background: var(--brand-gradient);
            border-color: transparent;
            color: white;
        }
        
        .btn-outline-primary:focus {
            box-shadow: 0 0 0 0.25rem rgba(0, 101, 183, 0.25);
        }

        .btn-outline-secondary {
            color: var(--brand-dark);
            border-color: #dee2e6;
        }
        
        .btn-outline-secondary:hover {
            background: var(--brand-dark);
            border-color: var(--brand-dark);
            color: white;
        }
        
        /* Botón Cambiar Contraseña */
        .btn-change-password {
            border-color: var(--brand-dark);
            color: var(--brand-dark);
        }
        
        .btn-change-password:hover {
            background: var(--brand-dark);
            border-color: var(--brand-dark);
            color: white;
        }

        /* Botón primario con gradiente */
        .btn-primary {
            background: var(--brand-gradient);
            border: none;
        }
        
        .btn-primary:hover,
        .btn-primary:focus,
        .btn-primary:active {
            background: linear-gradient(135deg, var(--brand-dark), var(--brand-blue));
            box-shadow: 0 4px 15px rgba(0, 101, 183, 0.35);
        }
        
        .btn-primary:focus {
            box-shadow: 0 0 0 0.25rem rgba(0, 101, 183, 0.25);
        }

        /* Radio buttons */
        .form-check-input[type="radio"]:checked {
            background-color: var(--brand-primary);
            border-color: var(--brand-primary);
        }

        /* Checkboxes */
        .form-check-input[type="checkbox"]:checked {
            background-color: var(--brand-primary);
            border-color: var(--brand-primary);
        }

        /* ============================================
           EMPTY STATES - Estados Vacíos
           ============================================ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 2rem;
            text-align: center;
            color: var(--text-muted);
        }
        
        .empty-state-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(0, 101, 183, 0.1), rgba(0, 156, 180, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            animation: float 3s ease-in-out infinite;
        }
        
        .empty-state-icon i {
            font-size: 2.5rem;
            background: var(--brand-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        
        .empty-state-text {
            font-size: 0.9rem;
            color: var(--text-muted);
            max-width: 300px;
            margin-bottom: 1.5rem;
        }
        
        .empty-state-action {
            background: var(--brand-gradient);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .empty-state-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 101, 183, 0.35);
            color: white;
        }

        /* ============================================
           SKELETON LOADERS - Estados de Carga
           ============================================ */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 8px;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        
        .skeleton-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
        }
        
        .skeleton-title {
            height: 14px;
            width: 60%;
            margin-bottom: 8px;
        }
        
        .skeleton-value {
            height: 28px;
            width: 40%;
        }
        
        .skeleton-text {
            height: 12px;
            width: 100%;
            margin-bottom: 6px;
        }
        
        .skeleton-text.short {
            width: 60%;
        }
        
        .skeleton-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
        }
        
        .skeleton-message {
            height: 60px;
            border-radius: 18px;
            margin-bottom: 1rem;
        }

        /* ============================================
           ANIMACIONES Y MICROINTERACCIONES
           ============================================ */
        
        /* Transiciones suaves para tabs */
        .tab-pane {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Ripple effect para botones */
        .btn-ripple {
            position: relative;
            overflow: hidden;
        }
        
        .btn-ripple::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, rgba(255,255,255,0.3) 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform 0.5s, opacity 0.5s;
        }
        
        .btn-ripple:active::after {
            transform: scale(0, 0);
            opacity: 0.3;
            transition: 0s;
        }
        
        /* Hover effects mejorados para cards */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 101, 183, 0.15);
        }
        
        /* Animación para badges de notificación */
        .badge-pulse {
            animation: badge-pulse 2s infinite;
        }
        
        @keyframes badge-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(220, 53, 69, 0); }
        }
        
        /* Animación de entrada para modales */
        .modal.fade .modal-dialog {
            transform: scale(0.9) translateY(-20px);
            transition: transform 0.3s ease-out;
        }
        
        .modal.show .modal-dialog {
            transform: scale(1) translateY(0);
        }
        
        /* Transición suave para sidebar items */
        .nav-link, .ticket-history-item {
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        
        /* Animación de carga para botones */
        .btn-loading {
            position: relative;
            pointer-events: none;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            top: 50%;
            left: 50%;
            margin-left: -9px;
            margin-top: -9px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        .btn-loading > * {
            opacity: 0;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ============================================
           ACCESIBILIDAD
           ============================================ */
        
        /* Focus states más visibles */
        *:focus-visible {
            outline: 3px solid var(--brand-primary);
            outline-offset: 2px;
        }
        
        .btn:focus-visible,
        .form-control:focus-visible,
        .form-select:focus-visible {
            outline: 3px solid var(--brand-primary);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(0, 156, 180, 0.2);
        }
        
        /* Skip link para navegación por teclado */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--brand-gradient);
            color: white;
            padding: 8px 16px;
            z-index: 9999;
            transition: top 0.3s;
            border-radius: 0 0 8px 0;
            font-weight: 600;
            text-decoration: none;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        /* Reducir movimiento para usuarios que lo prefieren */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Mejorar contraste de texto */
        .text-high-contrast {
            color: var(--text-dark) !important;
        }

        /* ============================================
           DARK MODE
           ============================================ */
        [data-theme="dark"] {
            --bg-body: #1a1a2e;
            --text-dark: #e4e4e7;
            --text-muted: #a1a1aa;
        }
        
        [data-theme="dark"] .main-wrapper {
            background-color: #16213e;
        }
        
        [data-theme="dark"] .kpi-card,
        [data-theme="dark"] .card,
        [data-theme="dark"] .metric-card {
            background: #1f2937;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .kpi-title,
        [data-theme="dark"] .text-muted {
            color: #9ca3af !important;
        }
        
        [data-theme="dark"] .kpi-value,
        [data-theme="dark"] h2, 
        [data-theme="dark"] h5,
        [data-theme="dark"] h6,
        [data-theme="dark"] .fw-bold {
            color: #e4e4e7 !important;
        }
        
        [data-theme="dark"] .title-gradient {
            background: linear-gradient(135deg, #67e8f9, #a5f3fc);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        [data-theme="dark"] .chat-messages {
            background: #111827;
        }
        
        [data-theme="dark"] .support-message .message-bubble {
            background: #374151;
            color: #e4e4e7;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .chat-input {
            background: #1f2937;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .chat-input input {
            background: #374151;
            color: #e4e4e7;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .form-select {
            background: #374151;
            color: #e4e4e7;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .modal-content {
            background: #1f2937;
        }
        
        [data-theme="dark"] .modal-header,
        [data-theme="dark"] .offcanvas-header {
            background: rgba(0, 101, 183, 0.1);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .modal-title,
        [data-theme="dark"] .offcanvas-title {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .btn-close {
            filter: invert(1);
        }
        
        [data-theme="dark"] .offcanvas {
            background: #1f2937;
        }
        
        [data-theme="dark"] .offcanvas-body {
            background: #111827 !important;
        }
        
        [data-theme="dark"] .offcanvas-header {
            background: linear-gradient(135deg, rgba(0, 101, 183, 0.2), rgba(0, 156, 180, 0.2)) !important;
        }
        
        [data-theme="dark"] #solicitudesOffcanvas .offcanvas-body {
            background: #111827 !important;
        }
        
        [data-theme="dark"] .offcanvas-footer,
        [data-theme="dark"] .offcanvas-footer.bg-white {
            background: #1f2937 !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        [data-theme="dark"] .solicitud-card {
            background: #1e293b !important;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .solicitud-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }
        
        [data-theme="dark"] .solicitud-titulo {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .solicitud-usuario {
            color: #9ca3af;
        }
        
        [data-theme="dark"] .solicitud-descripcion {
            color: #d1d5db;
        }
        
        [data-theme="dark"] .solicitud-meta .text-muted {
            color: #9ca3af !important;
        }
        
        [data-theme="dark"] .btn-ver-detalle {
            background: #374151;
            border-color: rgba(255, 255, 255, 0.15);
            color: #9ca3af;
        }
        
        [data-theme="dark"] .btn-ver-detalle:hover {
            background: #4b5563;
            color: #67e8f9;
        }
        
        [data-theme="dark"] .mobile-bottom-nav {
            background: #1f2937;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .mobile-nav-item {
            color: #9ca3af;
        }
        
        [data-theme="dark"] .mobile-nav-item.active {
            color: var(--brand-primary);
        }
        
        [data-theme="dark"] .skeleton {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
        }
        
        [data-theme="dark"] .empty-state-icon {
            background: linear-gradient(135deg, rgba(0, 101, 183, 0.2), rgba(0, 156, 180, 0.2));
        }
        
        [data-theme="dark"] .empty-state-title {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .kb-card {
            background: #374151;
        }
        
        [data-theme="dark"] .kb-title {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .quick-replies-panel {
            background: #1f2937;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .quick-reply-item {
            background: #374151;
        }
        
        [data-theme="dark"] .notifications-panel {
            background: transparent;
        }
        
        [data-theme="dark"] .notifications-container {
            background: #1f2937;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        [data-theme="dark"] .notifications-list {
            background: #1f2937;
        }
        
        [data-theme="dark"] .notification-item {
            border-color: rgba(255, 255, 255, 0.1);
            background: #1f2937;
        }
        
        [data-theme="dark"] .notification-item:hover {
            background: #374151;
        }
        
        [data-theme="dark"] .notification-item.unread {
            background: rgba(0, 156, 180, 0.15);
        }
        
        [data-theme="dark"] .notification-title {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .notification-text {
            color: #9ca3af;
        }
        
        [data-theme="dark"] .notification-time {
            color: #6b7280;
        }
        
        [data-theme="dark"] .notifications-container .p-3.border-top {
            background: #1f2937;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        [data-theme="dark"] .notifications-container .p-3.border-top a {
            color: #60a5fa !important;
        }
        
        [data-theme="dark"] .notifications-container .p-3.border-top a:hover {
            color: #93c5fd !important;
        }
        
        [data-theme="dark"] .audit-details {
            background: rgba(0, 101, 183, 0.1);
        }
        
        [data-theme="dark"] .ticket-history-item {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.08);
        }

        /* === DARK MODE - Elementos adicionales === */
        
        /* Navbar móvil */
        [data-theme="dark"] .navbar-top {
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
        }
        
        /* Texto general */
        [data-theme="dark"] p,
        [data-theme="dark"] span,
        [data-theme="dark"] label,
        [data-theme="dark"] .form-label,
        [data-theme="dark"] .form-check-label {
            color: #d1d5db;
        }
        
        /* Card bodies */
        [data-theme="dark"] .card-body {
            color: #e4e4e7;
        }
        
        /* Tablas */
        [data-theme="dark"] .table {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .table-hover tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        [data-theme="dark"] .table th,
        [data-theme="dark"] .table td {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Badges */
        [data-theme="dark"] .badge.bg-light {
            background: #374151 !important;
            color: #e4e4e7 !important;
        }
        
        /* Actividad Reciente Timeline */
        [data-theme="dark"] .activity-item,
        [data-theme="dark"] .audit-item {
            color: #d1d5db;
        }
        
        [data-theme="dark"] .audit-time,
        [data-theme="dark"] .audit-user {
            color: #9ca3af;
        }
        
        [data-theme="dark"] .audit-action {
            color: #e4e4e7;
        }
        
        /* Lista de tickets sidebar */
        [data-theme="dark"] .tickets-list-item {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .tickets-list-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        [data-theme="dark"] .ticket-title,
        [data-theme="dark"] .ticket-info h6 {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .ticket-preview,
        [data-theme="dark"] .ticket-time {
            color: #9ca3af;
        }
        
        /* Chat header */
        [data-theme="dark"] .chat-header {
            background: linear-gradient(135deg, rgba(0, 101, 183, 0.15), rgba(0, 156, 180, 0.15));
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .chat-header h5 {
            color: #e4e4e7 !important;
        }
        
        [data-theme="dark"] .chat-header small {
            color: #9ca3af !important;
        }
        
        /* Text brand colors en dark mode */
        [data-theme="dark"] .text-brand-blue {
            color: #67e8f9 !important;
        }
        
        [data-theme="dark"] .text-brand-dark {
            color: #a5f3fc !important;
        }
        
        /* Chat container */
        [data-theme="dark"] .chat-container {
            background: #1f2937;
        }
        
        /* Iconos KPI */
        [data-theme="dark"] .kpi-icon,
        [data-theme="dark"] .icon-blue,
        [data-theme="dark"] .icon-teal,
        [data-theme="dark"] .icon-purple {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* KB Cards */
        [data-theme="dark"] .kb-card {
            border-color: rgba(255, 255, 255, 0.1);
            background: #1e293b;
        }
        
        [data-theme="dark"] .kb-card:hover {
            border-color: var(--brand-primary);
            box-shadow: 0 5px 20px rgba(0, 156, 180, 0.3);
        }
        
        [data-theme="dark"] .kb-title {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .kb-count {
            color: #9ca3af;
        }
        
        [data-theme="dark"] .kb-icon {
            background: rgba(255, 255, 255, 0.1) !important;
        }
        
        [data-theme="dark"] .kb-icon.tech {
            background: rgba(103, 232, 249, 0.15) !important;
            color: #67e8f9 !important;
        }
        
        [data-theme="dark"] .kb-icon.account {
            background: rgba(165, 243, 252, 0.15) !important;
            color: #a5f3fc !important;
        }
        
        [data-theme="dark"] .kb-icon.payments {
            background: rgba(52, 211, 153, 0.15) !important;
            color: #34d399 !important;
        }
        
        [data-theme="dark"] .kb-icon.general {
            background: rgba(251, 191, 36, 0.15) !important;
            color: #fbbf24 !important;
        }
        
        /* Metric cards adicionales */
        [data-theme="dark"] .metric-card-header span {
            color: #9ca3af;
        }
        
        [data-theme="dark"] .metric-value {
            color: #67e8f9 !important;
        }
        
        [data-theme="dark"] .metric-change.positive {
            background: rgba(52, 211, 153, 0.2);
            color: #34d399;
        }
        
        [data-theme="dark"] .metric-change.negative {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }
        
        [data-theme="dark"] .mini-chart {
            background: #374151;
        }
        
        [data-theme="dark"] .chart-bar {
            background: rgba(0, 156, 180, 0.6);
        }
        
        /* Modal body */
        [data-theme="dark"] .modal-body {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .modal-footer {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Botones light */
        [data-theme="dark"] .btn-light {
            background: #374151;
            border-color: rgba(255, 255, 255, 0.1);
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .btn-light:hover {
            background: #4b5563;
            color: #fff;
        }
        
        /* Botón outline-secondary */
        [data-theme="dark"] .btn-outline-secondary {
            border-color: rgba(255, 255, 255, 0.2);
            color: #d1d5db;
        }
        
        [data-theme="dark"] .btn-outline-secondary:hover {
            background: #374151;
            border-color: #374151;
            color: #fff;
        }
        
        /* List group */
        [data-theme="dark"] .list-group-item {
            background: #374151;
            border-color: rgba(255, 255, 255, 0.1);
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .list-group-item:hover {
            background: #4b5563;
        }
        
        /* Offcanvas body */
        [data-theme="dark"] .offcanvas-body {
            color: #e4e4e7;
        }
        
        /* Input groups */
        [data-theme="dark"] .input-group-text,
        [data-theme="dark"] .input-group-text.bg-white {
            background: #374151 !important;
            border-color: rgba(255, 255, 255, 0.1);
            color: #9ca3af;
        }
        
        /* Participant items */
        [data-theme="dark"] .participant-item {
            background: #374151;
        }
        
        [data-theme="dark"] .participant-item span {
            color: #e4e4e7;
        }
        
        /* Attachment items */
        [data-theme="dark"] .attachment-item {
            background: #374151;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .attachment-item:hover {
            background: #4b5563;
            border-color: var(--brand-primary);
        }
        
        /* Dropdown menus */
        [data-theme="dark"] .dropdown-menu {
            background: #1f2937;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .dropdown-item {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .dropdown-item:hover {
            background: #374151;
            color: #fff;
        }
        
        /* Pagination */
        [data-theme="dark"] .page-link {
            background: #374151;
            border-color: rgba(255, 255, 255, 0.1);
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .page-item.active .page-link {
            background: var(--brand-gradient);
            border-color: transparent;
        }
        
        [data-theme="dark"] .page-item.disabled .page-link {
            background: #1f2937;
            color: #6b7280;
        }
        
        /* Accordions */
        [data-theme="dark"] .accordion-item {
            background: #1f2937;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .accordion-button {
            background: #374151;
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .accordion-button:not(.collapsed) {
            background: rgba(0, 101, 183, 0.2);
            color: #60a5fa;
        }
        
        [data-theme="dark"] .accordion-body {
            background: #1f2937;
            color: #d1d5db;
        }
        
        /* Quick reply items */
        [data-theme="dark"] .quick-reply-title {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .quick-reply-preview {
            color: #9ca3af;
        }
        
        [data-theme="dark"] .quick-reply-item:hover {
            background: #4b5563;
        }
        
        /* Tooltips y popovers */
        [data-theme="dark"] .tooltip-inner {
            background: #374151;
        }
        
        [data-theme="dark"] .popover {
            background: #1f2937;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .popover-header {
            background: #374151;
            color: #e4e4e7;
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .popover-body {
            color: #d1d5db;
        }
        
        /* Alerts */
        [data-theme="dark"] .alert {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Progress bars */
        [data-theme="dark"] .progress {
            background: #374151;
        }
        
        /* Nav tabs */
        [data-theme="dark"] .nav-tabs {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        [data-theme="dark"] .nav-tabs .nav-link {
            color: #9ca3af;
        }
        
        [data-theme="dark"] .nav-tabs .nav-link:hover {
            border-color: rgba(255, 255, 255, 0.1);
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .nav-tabs .nav-link.active {
            background: #1f2937;
            border-color: rgba(255, 255, 255, 0.1);
            color: #e4e4e7;
        }
        
        /* Text colors override */
        [data-theme="dark"] .text-dark {
            color: #e4e4e7 !important;
        }
        
        [data-theme="dark"] .text-secondary {
            color: #9ca3af !important;
        }
        
        /* Border colors */
        [data-theme="dark"] .border,
        [data-theme="dark"] .border-top,
        [data-theme="dark"] .border-bottom,
        [data-theme="dark"] .border-start,
        [data-theme="dark"] .border-end {
            border-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        /* Shadows ajustados para dark mode */
        [data-theme="dark"] .shadow,
        [data-theme="dark"] .shadow-sm,
        [data-theme="dark"] .shadow-lg {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4) !important;
        }
        
        /* Placeholder text */
        [data-theme="dark"] ::placeholder {
            color: #6b7280 !important;
            opacity: 1;
        }
        
        /* Scrollbar en dark mode */
        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        
        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: #4b5563;
        }
        
        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* FAB en dark mode */
        [data-theme="dark"] .fab {
            box-shadow: 0 4px 20px rgba(0, 101, 183, 0.5);
        }
        
        /* Horizontal rules */
        [data-theme="dark"] hr {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Strong y bold text */
        [data-theme="dark"] strong,
        [data-theme="dark"] b {
            color: #e4e4e7;
        }
        
        /* Small text */
        [data-theme="dark"] small {
            color: #9ca3af;
        }
        
        /* Links en dark mode */
        [data-theme="dark"] a:not(.btn):not(.nav-link) {
            color: #60a5fa;
        }
        
        [data-theme="dark"] a:not(.btn):not(.nav-link):hover {
            color: #93c5fd;
        }
        
        /* Filter section en sidebar */
        [data-theme="dark"] .sidebar-section {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.08);
        }
        
        /* User status badge */
        [data-theme="dark"] .user-avatar {
            border-color: #374151;
        }
        
        [data-theme="dark"] .user-status {
            border-color: #1f2937;
        }
        
        /* Botón Cambiar Contraseña en perfil */
        [data-theme="dark"] .btn-change-password {
            border-color: rgba(255, 255, 255, 0.3) !important;
            color: #e4e4e7 !important;
        }
        
        [data-theme="dark"] .btn-change-password:hover {
            background: #374151 !important;
            border-color: #4b5563 !important;
            color: #fff !important;
        }
        
        /* Alert info para dark mode */
        [data-theme="dark"] .alert-info {
            background: rgba(0, 156, 180, 0.15) !important;
            border-color: rgba(0, 156, 180, 0.3) !important;
            color: #67e8f9 !important;
        }
        
        [data-theme="dark"] .alert-info .bi {
            color: #22d3ee !important;
        }
        
        /* Avatares en tickets y listas */
        [data-theme="dark"] .rounded-circle[style*="background: white"],
        [data-theme="dark"] .rounded-circle[style*="background:#fff"],
        [data-theme="dark"] .bg-white.rounded-circle {
            background: #374151 !important;
        }
        
        [data-theme="dark"] .rounded-circle .bi-person-fill {
            color: #60a5fa !important;
        }
        
        /* Input file en dark mode */
        [data-theme="dark"] input[type="file"]::file-selector-button {
            background: #374151;
            color: #e4e4e7;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        [data-theme="dark"] input[type="file"]::file-selector-button:hover {
            background: #4b5563;
        }
        
        /* Estadísticas en modal de reportes */
        [data-theme="dark"] .card[style*="border-left: 4px solid"],
        [data-theme="dark"] .card[style*="border-left:4px solid"] {
            background: #1e3a5f !important;
        }
        
        [data-theme="dark"] .card[style*="border-left: 4px solid"] h2,
        [data-theme="dark"] .card[style*="border-left:4px solid"] h2 {
            color: #60a5fa !important;
        }
        
        [data-theme="dark"] .card[style*="border-left: 4px solid"] small,
        [data-theme="dark"] .card[style*="border-left:4px solid"] small {
            color: #9ca3af !important;
        }
        
        /* Texto en ticket item mobile */
        [data-theme="dark"] .ticket-item p {
            color: #d1d5db !important;
        }
        
        /* Texto Asunto en offcanvas */
        [data-theme="dark"] .offcanvas h6.fw-bold {
            color: #e4e4e7 !important;
        }
        
        [data-theme="dark"] .offcanvas p.mb-0:not([class*="text-"]) {
            color: #d1d5db !important;
        }
        
        /* Badges de rol en equipo de soporte */
        [data-theme="dark"] .badge.bg-success-subtle {
            background: rgba(34, 197, 94, 0.2) !important;
            color: #4ade80 !important;
        }
        
        [data-theme="dark"] .badge.bg-secondary-subtle {
            background: rgba(156, 163, 175, 0.2) !important;
            color: #d1d5db !important;
        }
        
        /* Tarjetas de métricas en reportes - fondo con gradiente */
        [data-theme="dark"] .modal-body .card.border-0.text-center {
            background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%) !important;
        }
        
        [data-theme="dark"] .modal-body .card.border-0.text-center h2 {
            color: #67e8f9 !important;
        }
        
        /* Tabla de tickets recientes */
        [data-theme="dark"] .table-responsive .table th {
            background: #1e293b !important;
            color: #e4e4e7 !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        [data-theme="dark"] .table-responsive .table td {
            background: #111827 !important;
            border-color: rgba(255, 255, 255, 0.08) !important;
            color: #d1d5db !important;
        }
        
        [data-theme="dark"] .table-responsive .table tbody tr:hover td {
            background: #1f2937 !important;
        }
        
        /* Fix para texto en listas dentro de cards */
        [data-theme="dark"] .card-body .d-flex span.fw-medium,
        [data-theme="dark"] .card-body .d-flex span.text-muted {
            color: #d1d5db !important;
        }
        
        /* Botón circular de 3 puntos en tickets */
        [data-theme="dark"] .btn.rounded-circle[style*="background: white"] {
            background: #374151 !important;
        }
        
        [data-theme="dark"] .btn.rounded-circle[style*="background: white"] i {
            color: #e4e4e7 !important;
        }
        
        /* bg-light en dark mode */
        [data-theme="dark"] .bg-light {
            background: #1e3a5f !important;
        }
        
        /* Stat cards en modal de reportes */
        [data-theme="dark"] .modal-body .p-3.rounded-3.bg-light {
            background: linear-gradient(135deg, #1e3a5f 0%, #1e4d6b 100%) !important;
            border: 1px solid rgba(96, 165, 250, 0.2);
        }
        
        [data-theme="dark"] .modal-body .p-3.rounded-3.bg-light .text-brand-blue {
            color: #67e8f9 !important;
        }
        
        [data-theme="dark"] .modal-body .p-3.rounded-3.bg-light .text-success {
            color: #4ade80 !important;
        }
        
        [data-theme="dark"] .modal-body .p-3.rounded-3.bg-light .text-warning {
            color: #fbbf24 !important;
        }
        
        [data-theme="dark"] .modal-body .p-3.rounded-3.bg-light .text-info {
            color: #22d3ee !important;
        }
        
        /* Gráficos en modal de reportes */
        [data-theme="dark"] .modal-body .p-3.rounded-3.border {
            background: #111827 !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }
        
        [data-theme="dark"] .modal-body .p-3.rounded-3.border h6 {
            color: #e4e4e7 !important;
        }
        
        /* Participant avatar fix */
        [data-theme="dark"] .participant-avatar {
            background: linear-gradient(135deg, #3b82f6, #06b6d4) !important;
        }
        
        [data-theme="dark"] .participant-avatar.bg-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
        }
        
        [data-theme="dark"] .participant-avatar.bg-info {
            background: linear-gradient(135deg, #06b6d4, #0891b2) !important;
        }
        
        /* Nombres en participant item */
        [data-theme="dark"] .participant-item .fw-semibold {
            color: #e4e4e7 !important;
        }
        
        /* Details section labels */
        [data-theme="dark"] .offcanvas .text-muted {
            color: #9ca3af !important;
        }
        
        /* Ticket ID values */
        [data-theme="dark"] .offcanvas .fw-bold:not(.title-gradient):not(h5):not(h6) {
            color: #e4e4e7 !important;
        }
        
        /* Chat user avatar fix - fondo visible para el icono */
        [data-theme="dark"] .chat-user-avatar {
            background: linear-gradient(135deg, #3b82f6, #06b6d4) !important;
        }

        /* ============================================
           PERFIL DE USUARIO MEJORADO
           ============================================ */
        .user-avatar-container {
            position: relative;
            display: inline-block;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--brand-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0, 101, 183, 0.25);
        }
        
        .user-status {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 3px solid white;
        }
        
        .user-status.online {
            background: #22c55e;
            animation: status-pulse 2s infinite;
        }
        
        .user-status.away {
            background: #f59e0b;
        }
        
        .user-status.offline {
            background: #6b7280;
        }
        
        @keyframes status-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            50% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
        }

        /* ============================================
           TOASTS MEJORADOS
           ============================================ */
        .toast-container-custom {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        @media (max-width: 767.98px) {
            .toast-container-custom {
                top: 70px;
                right: 10px;
                left: 10px;
            }
        }
        
        .toast-custom {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            background: white;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            animation: toast-slide-in 0.3s ease;
            max-width: 400px;
        }
        
        @keyframes toast-slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .toast-custom.toast-exit {
            animation: toast-slide-out 0.3s ease forwards;
        }
        
        @keyframes toast-slide-out {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        .toast-custom.success .toast-icon {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }
        
        .toast-custom.error .toast-icon {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }
        
        .toast-custom.warning .toast-icon {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }
        
        .toast-custom.info .toast-icon {
            background: rgba(0, 156, 180, 0.15);
            color: var(--brand-primary);
        }
        
        .toast-content {
            flex: 1;
            min-width: 0;
        }
        
        .toast-title {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
            margin-bottom: 2px;
        }
        
        .toast-message {
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .toast-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 6px;
            transition: all 0.2s;
        }
        
        .toast-close:hover {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text-dark);
        }
        
        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            border-radius: 0 0 12px 12px;
            animation: toast-progress 4s linear forwards;
        }
        
        .toast-custom.success .toast-progress { background: #22c55e; }
        .toast-custom.error .toast-progress { background: #ef4444; }
        .toast-custom.warning .toast-progress { background: #f59e0b; }
        .toast-custom.info .toast-progress { background: var(--brand-primary); }
        
        @keyframes toast-progress {
            from { width: 100%; }
            to { width: 0%; }
        }

        /* ============================================
           CONFIRMACIONES MEJORADAS
           ============================================ */
        .confirm-modal .modal-content {
            border-radius: 20px;
            overflow: hidden;
        }
        
        .confirm-modal .modal-body {
            padding: 2rem;
            text-align: center;
        }
        
        .confirm-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2.5rem;
        }
        
        .confirm-icon.warning {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }
        
        .confirm-icon.danger {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }
        
        .confirm-icon.success {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }
        
        .confirm-icon.info {
            background: rgba(0, 156, 180, 0.15);
            color: var(--brand-primary);
        }
        
        .confirm-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        
        .confirm-message {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }
        
        .confirm-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .confirm-actions .btn {
            min-width: 120px;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: 600;
        }

        [data-theme="dark"] .toast-custom {
            background: #1f2937;
        }
        
        [data-theme="dark"] .toast-title {
            color: #e4e4e7;
        }
        
        [data-theme="dark"] .confirm-title {
            color: #e4e4e7;
        }
    </style>
</head>
<body>
    <!-- Skip Link para Accesibilidad -->
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
    
    <!-- Contenedor de Toasts Mejorados -->
    <div class="toast-container-custom" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <!-- Panel de Notificaciones Flotante -->
    <div class="notifications-panel" id="notificationsPanel" role="dialog" aria-label="Panel de notificaciones">
        <div class="notifications-container">
            <div class="notifications-header">
                <div>
                    <h6 class="mb-0 fw-bold">Notificaciones</h6>
                    <small class="opacity-75"><span id="unreadCount">4</span> sin leer</small>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-light rounded-pill" onclick="markAllAsRead()">
                        <i class="bi bi-check-all"></i> Marcar todas
                    </button>
                    <button class="btn btn-sm btn-link text-white p-0" onclick="toggleNotifications()">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
            </div>
            <div class="notifications-list" id="notificationsList">
                <!-- Las notificaciones se cargan dinámicamente -->
            </div>
            <div class="p-3 border-top text-center">
                <a href="#" class="text-decoration-none text-brand-blue fw-semibold" onclick="showAllNotifications()">
                    Ver todas las notificaciones
                </a>
            </div>
        </div>
    </div>

    <!-- Navbar superior con logo - Solo móvil -->
    <nav class="navbar-top d-md-none">
        <div class="container-fluid d-flex justify-content-between align-items-center py-2 px-3">
            <div style="width: 40px;"></div>
            <img src="{{ url_for('static', filename='logo-club-recrear.svg') }}" alt="Club Recrear" class="navbar-logo">
            <button class="notification-badge-btn" onclick="toggleNotifications()">
                <i class="bi bi-bell-fill text-white fs-5"></i>
                <span class="badge-count" id="notifBadgeMobile">4</span>
            </button>
        </div>
    </nav>

    <div class="container-fluid h-100 p-0">
        <div class="row h-100 g-0 row-principal" >
            
            <div class="col-md-2 d-none d-md-flex flex-column sidebar p-3" style="height: 100vh; overflow-y: auto;">
                
                <div class="logo-container text-center">
                    <img src="{{ url_for('static', filename='logo-club-recrear.svg') }}" alt="logo">
                </div>

                <ul class="nav nav-pills flex-column" id="dashboardTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active w-100 text-start" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab">
                            <i class="bi bi-house-door-fill"></i> Home
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="ticket-tab" data-bs-toggle="tab" data-bs-target="#ticket" type="button" role="tab">
                            <i class="bi bi-ticket-perforated-fill"></i> Tickets
                        </button>
                    </li>   
                    <li class="nav-item" role="presentation">
                        <button class="nav-link w-100 text-start" id="config-tab" data-bs-toggle="tab" data-bs-target="#config" type="button" role="tab">
                            <i class="bi bi-gear-fill"></i> Config
                        </button>
                    </li>
                </ul>
                
                <div class="sidebar-section flex-grow-1 d-flex flex-column" style="min-height: 0; overflow: hidden;">
                    <div class="d-flex align-items-center justify-content-between text-white-50 mb-3">
                        <div class="d-flex align-items-center gap-2">
                            <button class="btn btn-link text-white-50 p-1" title="Buscar tickets" data-bs-toggle="modal" data-bs-target="#searchTicketsModal">
                                <i class="bi bi-search"></i>
                            </button>
                            <button class="btn btn-link text-white-50 p-1" title="Filtrar tickets" data-bs-toggle="modal" data-bs-target="#filtersModal">
                                <i class="bi bi-funnel-fill"></i>
                            </button>
                        </div>
                        <button class="btn btn-link text-white-50 p-1" title="Nuevo ticket" data-bs-toggle="modal" data-bs-target="#newTicketModal">
                            <i class="bi bi-plus-circle-fill"></i>
                        </button>
                    </div>
                    <div class="tickets-history" style="overflow-y: auto; flex: 1;">
                        <!-- Ticket Item -->
                        <div class="ticket-history-item active" onclick="openTicketFromSidebar('1001', this)">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="ticket-history-title">#1001 - Problema con acceso</div>
                                <span class="ticket-history-badge">3</span>
                            </div>
                        </div>
                        <div class="ticket-history-item" onclick="openTicketFromSidebar('1002', this)">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="ticket-history-title">#1002 - Ayuda con cuenta</div>
                            </div>
                        </div>
                        <div class="ticket-history-item" onclick="openTicketFromSidebar('1003', this)">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="ticket-history-title">#1003 - Error en pagos</div>
                            </div>
                        </div>
                        <div class="ticket-history-item" onclick="openTicketFromSidebar('1004', this)">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="ticket-history-title">#1004 - Consulta membresía</div>
                            </div>
                        </div>
                        <div class="ticket-history-item" onclick="openTicketFromSidebar('1005', this)">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="ticket-history-title">#1005 - Reset password</div>
                            </div>
                        </div>
                        <div class="ticket-history-item" onclick="openTicketFromSidebar('1006', this)">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="ticket-history-title">#1006 - Actualizar datos</div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>

            <div class="col h-100 columna-cont">
                <div class="main-wrapper" id="main-content" role="main">
                    
                    <div class="tab-content" id="myTabContent">
                        
                        <div class="tab-pane fade show active" id="home" role="tabpanel">
                            <!-- Mobile Header - Solo en Home (sin filtros) -->
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <div>
                                    <h2 class="fw-bold title-gradient mb-1">Dashboard</h2>
                                    <p class="text-muted">Resumen de actividad de hoy</p>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <!-- Botón de Notificaciones -->
                                    <button class="notification-badge-btn d-none d-md-inline-flex" onclick="toggleNotifications()">
                                        <i class="bi bi-bell-fill text-muted fs-5"></i>
                                        <span class="badge-count" id="notifBadgeDesktop">4</span>
                                    </button>
                                    <!-- Botón de Solicitudes Pendientes -->
                                    <button class="btn btn-outline-primary rounded-pill position-relative d-none d-md-inline-flex align-items-center gap-2" data-bs-toggle="offcanvas" data-bs-target="#solicitudesOffcanvas" aria-controls="solicitudesOffcanvas">
                                        <i class="bi bi-inbox-fill"></i>
                                        <span>Solicitudes</span>
                                        <span class="badge bg-danger rounded-pill" id="solicitudesCounterDesktop">3</span>
                                    </button>
                                    <button class="btn btn-primary rounded-pill px-4 py-2 fw-bold d-none d-md-inline-block" style="background: var(--brand-gradient); border:none; box-shadow: 0 4px 15px rgba(0, 156, 180, 0.3);" data-bs-toggle="modal" data-bs-target="#newTicketModal">
                                        <i class="bi bi-plus-lg me-2"></i> Nuevo Ticket
                                    </button>
                                </div>
                            </div>

                            <div class="row g-4 mb-5">
                                <div class="col-md-4">
                                    <div class="kpi-card">
                                        <div class="kpi-icon icon-blue">
                                            <i class="bi bi-ticket-fill"></i>
                                        </div>
                                        <div>
                                            <p class="kpi-title">Tickets Abiertos</p>
                                            <h3 class="kpi-value">12</h3>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="kpi-card">
                                        <div class="kpi-icon icon-teal">
                                            <i class="bi bi-bar-chart-fill"></i>
                                        </div>
                                        <div>
                                            <p class="kpi-title">Nuevos Hoy</p>
                                            <h3 class="kpi-value">5</h3>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="kpi-card">
                                        <div class="kpi-icon icon-purple">
                                            <i class="bi bi-people-fill"></i>
                                        </div>
                                        <div>
                                            <p class="kpi-title">Usuarios Activos</p>
                                            <h3 class="kpi-value">150</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Métricas Detalladas -->
                            <div class="row g-4 mb-4">
                                <div class="col-md-3 col-6">
                                    <div class="metric-card">
                                        <div class="metric-card-header">
                                            <span class="text-muted small">Tiempo Promedio</span>
                                            <span class="metric-change positive"><i class="bi bi-arrow-down"></i> 12%</span>
                                        </div>
                                        <div class="metric-value">2.4h</div>
                                        <div class="mini-chart mt-2">
                                            <div class="chart-bar" style="height: 40%"></div>
                                            <div class="chart-bar" style="height: 60%"></div>
                                            <div class="chart-bar" style="height: 45%"></div>
                                            <div class="chart-bar" style="height: 80%"></div>
                                            <div class="chart-bar" style="height: 55%"></div>
                                            <div class="chart-bar" style="height: 35%"></div>
                                            <div class="chart-bar" style="height: 70%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-6">
                                    <div class="metric-card">
                                        <div class="metric-card-header">
                                            <span class="text-muted small">Resueltos Hoy</span>
                                            <span class="metric-change positive"><i class="bi bi-arrow-up"></i> 8%</span>
                                        </div>
                                        <div class="metric-value">18</div>
                                        <div class="mini-chart mt-2">
                                            <div class="chart-bar" style="height: 30%"></div>
                                            <div class="chart-bar" style="height: 50%"></div>
                                            <div class="chart-bar" style="height: 65%"></div>
                                            <div class="chart-bar" style="height: 45%"></div>
                                            <div class="chart-bar" style="height: 75%"></div>
                                            <div class="chart-bar" style="height: 60%"></div>
                                            <div class="chart-bar" style="height: 90%"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-6">
                                    <div class="metric-card">
                                        <div class="metric-card-header">
                                            <span class="text-muted small">Satisfacción</span>
                                            <span class="metric-change positive"><i class="bi bi-arrow-up"></i> 3%</span>
                                        </div>
                                        <div class="metric-value">94%</div>
                                        <div class="progress mt-3" style="height: 8px;">
                                            <div class="progress-bar" role="progressbar" style="width: 94%; background: var(--brand-gradient)"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-6">
                                    <div class="metric-card">
                                        <div class="metric-card-header">
                                            <span class="text-muted small">Pendientes</span>
                                            <span class="metric-change negative"><i class="bi bi-arrow-up"></i> 2</span>
                                        </div>
                                        <div class="metric-value">7</div>
                                        <div class="metric-badges">
                                            <span class="badge prioridad-critica">2 Crít.</span>
                                            <span class="badge prioridad-alta">3 Alta</span>
                                            <span class="badge prioridad-media">2 Med.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Base de Conocimiento -->
                            <div class="card border-0 shadow-sm rounded-4 p-4 mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5 class="fw-bold text-brand-blue mb-0">
                                        <i class="bi bi-book me-2"></i>Base de Conocimiento
                                    </h5>
                                    <button class="btn btn-sm btn-outline-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#knowledgeBaseModal">
                                        Ver todo <i class="bi bi-arrow-right ms-1"></i>
                                    </button>
                                </div>
                                <div class="row g-3">
                                    <div class="col-md-3 col-6">
                                        <div class="kb-card" onclick="openKBCategory('tech')">
                                            <div class="kb-icon tech">
                                                <i class="bi bi-gear-wide-connected"></i>
                                            </div>
                                            <div class="kb-title">Soporte Técnico</div>
                                            <div class="kb-count">15 artículos</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-6">
                                        <div class="kb-card" onclick="openKBCategory('account')">
                                            <div class="kb-icon account">
                                                <i class="bi bi-person-badge"></i>
                                            </div>
                                            <div class="kb-title">Cuenta y Acceso</div>
                                            <div class="kb-count">12 artículos</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-6">
                                        <div class="kb-card" onclick="openKBCategory('payments')">
                                            <div class="kb-icon payments">
                                                <i class="bi bi-credit-card"></i>
                                            </div>
                                            <div class="kb-title">Pagos y Facturación</div>
                                            <div class="kb-count">8 artículos</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-6">
                                        <div class="kb-card" onclick="openKBCategory('general')">
                                            <div class="kb-icon general">
                                                <i class="bi bi-question-circle"></i>
                                            </div>
                                            <div class="kb-title">Preguntas Frecuentes</div>
                                            <div class="kb-count">20 artículos</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tickets Recientes con Historial -->
                            <div class="row g-4">
                                <div class="col-md-8">
                                    <div class="card border-0 shadow-sm rounded-4 p-4">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="fw-bold text-brand-blue mb-0">Tickets Recientes</h5>
                                            <button class="btn btn-sm btn-outline-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#reportModal">
                                                <i class="bi bi-file-earmark-bar-graph me-1"></i> Reportes
                                            </button>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Asunto</th>
                                                        <th>Usuario</th>
                                                        <th>Prioridad</th>
                                                        <th>Estado</th>
                                                        <th></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="fw-semibold text-brand-blue">#1001</td>
                                                        <td>Problema con acceso</td>
                                                        <td>Juan Pérez</td>
                                                        <td><span class="badge prioridad-alta">Alta</span></td>
                                                        <td><span class="badge bg-warning text-dark">Pendiente</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary" onclick="showAuditHistory('1001')">
                                                                <i class="bi bi-clock-history"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-semibold text-brand-blue">#1002</td>
                                                        <td>Ayuda con cuenta</td>
                                                        <td>Ana García</td>
                                                        <td><span class="badge prioridad-media">Media</span></td>
                                                        <td><span class="badge bg-primary">Abierto</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary" onclick="showAuditHistory('1002')">
                                                                <i class="bi bi-clock-history"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-semibold text-brand-blue">#1003</td>
                                                        <td>Error en pagos</td>
                                                        <td>Carlos López</td>
                                                        <td><span class="badge prioridad-critica">Crítica</span></td>
                                                        <td><span class="badge bg-info">En Proceso</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary" onclick="showAuditHistory('1003')">
                                                                <i class="bi bi-clock-history"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td class="fw-semibold text-brand-blue">#1004</td>
                                                        <td>Consulta membresía</td>
                                                        <td>María Rodríguez</td>
                                                        <td><span class="badge prioridad-baja">Baja</span></td>
                                                        <td><span class="badge bg-success">Resuelto</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary" onclick="showAuditHistory('1004')">
                                                                <i class="bi bi-clock-history"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card border-0 shadow-sm rounded-4 p-4 h-100">
                                        <h5 class="fw-bold text-brand-blue mb-3">
                                            <i class="bi bi-activity me-2"></i>Actividad Reciente
                                        </h5>
                                        <div class="audit-timeline">
                                            <div class="audit-item action-create">
                                                <div class="audit-time">Hace 5 min</div>
                                                <div class="audit-action">Nuevo ticket creado</div>
                                                <div class="audit-user">por Juan Pérez</div>
                                            </div>
                                            <div class="audit-item action-assign">
                                                <div class="audit-time">Hace 15 min</div>
                                                <div class="audit-action">Ticket #1002 asignado</div>
                                                <div class="audit-user">a María González</div>
                                            </div>
                                            <div class="audit-item action-update">
                                                <div class="audit-time">Hace 30 min</div>
                                                <div class="audit-action">Respuesta enviada</div>
                                                <div class="audit-user">en Ticket #1001</div>
                                            </div>
                                            <div class="audit-item action-close">
                                                <div class="audit-time">Hace 1 hora</div>
                                                <div class="audit-action">Ticket #1004 cerrado</div>
                                                <div class="audit-user">por Carlos Ruiz</div>
                                            </div>
                                            <div class="audit-item action-reopen">
                                                <div class="audit-time">Hace 2 horas</div>
                                                <div class="audit-action">Ticket #998 reabierto</div>
                                                <div class="audit-user">por el usuario</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="tab-pane fade" id="ticket" role="tabpanel">
                            <!-- Mobile Header - Solo en Tickets (con búsqueda y filtros) -->
                            <div class="d-md-none mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-3 px-3 pt-3">
                                    <h4 class="fw-bold text-brand-blue mb-0">Tickets</h4>
                                    <button class="btn btn-outline-primary" onclick="showFiltersModal()">
                                        <i class="bi bi-funnel"></i>
                                    </button>
                                </div>
                                <!-- Barra de búsqueda móvil -->
                                <div class="px-3">
                                    <div class="input-group">
                                        <span class="input-group-text bg-white border-end-0">
                                            <i class="bi bi-search text-muted"></i>
                                        </span>
                                        <input type="text" class="form-control border-start-0 ps-0" id="mobileSearchInput" placeholder="Buscar tickets...">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Mobile Tickets List (WhatsApp style) -->
                            <div class="tickets-list d-md-none" id="mobileTicketsList">
                                <div class="tickets-list-item" onclick="openMobileChat('1001')">
                                    <div class="ticket-avatar">
                                        <i class="bi bi-person-circle"></i>
                                    </div>
                                    <div class="ticket-info">
                                        <div class="ticket-header">
                                            <h6 class="ticket-title">Ticket #1001</h6>
                                            <span class="ticket-time">10:37</span>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <p class="ticket-preview mb-0">¡Funcionó! Muchas gracias por la ayuda...</p>
                                            <span class="ticket-badge">3</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="tickets-list-item" onclick="openMobileChat('1002')">
                                    <div class="ticket-avatar">
                                        <i class="bi bi-person-circle"></i>
                                    </div>
                                    <div class="ticket-info">
                                        <div class="ticket-header">
                                            <h6 class="ticket-title">Ticket #1002</h6>
                                            <span class="ticket-time">Ayer</span>
                                        </div>
                                        <p class="ticket-preview mb-0">Necesito ayuda con mi cuenta</p>
                                    </div>
                                </div>
                                <div class="tickets-list-item" onclick="openMobileChat('1003')">
                                    <div class="ticket-avatar">
                                        <i class="bi bi-person-circle"></i>
                                    </div>
                                    <div class="ticket-info">
                                        <div class="ticket-header">
                                            <h6 class="ticket-title">Ticket #1003</h6>
                                            <span class="ticket-time">Lun</span>
                                        </div>
                                        <p class="ticket-preview mb-0">Error en el sistema de pagos</p>
                                    </div>
                                </div>
                                <div class="tickets-list-item" onclick="openMobileChat('1004')">
                                    <div class="ticket-avatar">
                                        <i class="bi bi-person-circle"></i>
                                    </div>
                                    <div class="ticket-info">
                                        <div class="ticket-header">
                                            <h6 class="ticket-title">Ticket #1004</h6>
                                            <span class="ticket-time">Dom</span>
                                        </div>
                                        <p class="ticket-preview mb-0">Consulta sobre mi membresía</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Chat Container (Desktop and when ticket selected on mobile) -->
                            <div class="chat-container d-none" id="mobileChatContainer">
                                <!-- Chat Header -->
                                <div class="chat-header">
                                    <div class="d-flex align-items-center">
                                        <button class="btn btn-link text-brand-blue p-0 me-3" id="chatBackButton" type="button" onclick="closeMobileChat(); return false;">
                                            <i class="bi bi-arrow-left fs-4"></i>
                                        </button>
                                        <div class="chat-user-avatar me-3">
                                            <i class="bi bi-person-circle"></i>
                                        </div>
                                        <div class="flex-grow-1 cursor-pointer" data-bs-toggle="offcanvas" data-bs-target="#ticketDetailsOffcanvas" style="cursor: pointer;">
                                            <h5 class="mb-0 fw-bold text-brand-blue">Ticket #1001</h5>
                                            <small class="text-muted">Asunto: Problema con acceso al sistema Lorem ipsum dolor sit amet consectetur adipisicing elit. Pariatur, recusandae nihil ea est explicabo laudantium voluptatem aliquid, facere quisquam tenetur sit eligendi repellat dicta earum velit, commodi cupiditate ipsum molestias!</small>
                                        </div>
                                        <div class="d-flex align-items-center gap-2">
                                            <span class="badge bg-warning text-dark d-flex align-items-center justify-content-center px-3 py-2" style="min-width:80px;">Pendiente</span>
                                            <button class="btn btn-sm btn-outline-secondary rounded-circle d-flex align-items-center justify-content-center" style="width: 36px; height: 36px;" data-bs-toggle="offcanvas" data-bs-target="#ticketDetailsOffcanvas">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Chat Messages -->
                                <div class="chat-messages" id="chatMessages">
                                    <!-- Mensaje del usuario cliente -->
                                    <div class="message-wrapper support-message">
                                        <div class="message-avatar">
                                            <i class="bi bi-person-circle"></i>
                                        </div>
                                        <div class="message-content">
                                            <div class="message-bubble">
                                                <strong class="d-block mb-1 text-brand-blue">Juan Pérez</strong>
                                                <p class="mb-1">Hola, tengo un problema para acceder al sistema. Me dice que mi contraseña es incorrecta pero estoy seguro que es la correcta.</p>
                                            </div>
                                            <small class="message-time">10:30 AM</small>
                                        </div>
                                    </div>

                                    <!-- Mensaje del soporte (tú) -->
                                    <div class="message-wrapper user-message">
                                        <div class="message-content">
                                            <div class="message-bubble">
                                                <p class="mb-1">¡Hola! Entiendo tu situación. Voy a revisar tu cuenta y verificar el estado de tu acceso.</p>
                                            </div>
                                            <small class="message-time">10:32 AM</small>
                                        </div>
                                    </div>

                                    <!-- Mensaje del usuario cliente -->
                                    <div class="message-wrapper support-message">
                                        <div class="message-avatar">
                                            <i class="bi bi-person-circle"></i>
                                        </div>
                                        <div class="message-content">
                                            <div class="message-bubble">
                                                <strong class="d-block mb-1 text-brand-blue">Juan Pérez</strong>
                                                <p class="mb-1">Perfecto, gracias. ¿Cuánto tiempo puede tomar?</p>
                                            </div>
                                            <small class="message-time">10:33 AM</small>
                                        </div>
                                    </div>

                                    <!-- Mensaje del soporte (tú) -->
                                    <div class="message-wrapper user-message">
                                        <div class="message-content">
                                            <div class="message-bubble">
                                                <p class="mb-1">Ya revisé tu cuenta. El problema fue que hubo 3 intentos fallidos y se bloqueó temporalmente. Acabo de desbloquearlo. Por favor intenta nuevamente con tu contraseña.</p>
                                            </div>
                                            <small class="message-time">10:35 AM</small>
                                        </div>
                                    </div>

                                    <!-- Mensaje del usuario cliente -->
                                    <div class="message-wrapper support-message">
                                        <div class="message-avatar">
                                            <i class="bi bi-person-circle"></i>
                                        </div>
                                        <div class="message-content">
                                            <div class="message-bubble">
                                                <strong class="d-block mb-1 text-brand-blue">Juan Pérez</strong>
                                                <p class="mb-1">¡Funcionó! Muchas gracias por la ayuda rápida 🙏</p>
                                            </div>
                                            <small class="message-time">10:37 AM</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Chat Input -->
                                <div class="chat-input position-relative">
                                    <!-- Panel de Respuestas Rápidas Inline -->
                                    <div class="quick-replies-panel" id="quickRepliesInline">
                                        <div class="p-3 border-bottom d-flex justify-content-between align-items-center bg-light">
                                            <span class="fw-bold text-brand-blue"><i class="bi bi-lightning-fill me-1"></i>Respuestas Rápidas</span>
                                            <button class="btn btn-sm btn-link p-0" onclick="toggleQuickReplies()"><i class="bi bi-x-lg"></i></button>
                                        </div>
                                        <div class="quick-reply-item" onclick="insertQuickReply('Hola, gracias por contactarnos. Mi nombre es María y estaré ayudándote con tu solicitud.')">
                                            <div class="quick-reply-title">Saludo Inicial</div>
                                            <div class="quick-reply-preview">Hola, gracias por contactarnos...</div>
                                        </div>
                                        <div class="quick-reply-item" onclick="insertQuickReply('Para poder ayudarte mejor, necesito que me proporciones la siguiente información: tu nombre de usuario y una descripción detallada del problema.')">
                                            <div class="quick-reply-title">Solicitar Información</div>
                                            <div class="quick-reply-preview">Para poder ayudarte mejor...</div>
                                        </div>
                                        <div class="quick-reply-item" onclick="insertQuickReply('Hemos enviado un enlace de recuperación a tu correo electrónico. Por favor revisa tu bandeja de entrada y la carpeta de spam.')">
                                            <div class="quick-reply-title">Reset de Contraseña</div>
                                            <div class="quick-reply-preview">Hemos enviado un enlace...</div>
                                        </div>
                                        <div class="quick-reply-item" onclick="insertQuickReply('Me alegra que hayamos podido resolver tu problema. Si tienes alguna otra consulta, no dudes en contactarnos. ¡Que tengas un excelente día!')">
                                            <div class="quick-reply-title">Ticket Resuelto</div>
                                            <div class="quick-reply-preview">Me alegra que hayamos podido...</div>
                                        </div>
                                        <div class="p-2 border-top text-center">
                                            <a href="#" class="small text-brand-blue" data-bs-toggle="modal" data-bs-target="#quickRepliesModal" onclick="toggleQuickReplies()">Ver todas las respuestas</a>
                                        </div>
                                    </div>
                                    <input type="file" id="fileAttachment" multiple hidden>
                                    <button class="btn btn-link text-muted p-0 me-2" onclick="document.getElementById('fileAttachment').click()" title="Adjuntar archivo">
                                        <i class="bi bi-paperclip fs-5"></i>
                                    </button>
                                    <button class="btn btn-link text-muted p-0 me-2" onclick="toggleQuickReplies()" title="Respuestas rápidas">
                                        <i class="bi bi-lightning-fill fs-5"></i>
                                    </button>
                                    <input type="text" class="form-control border-0 flex-grow-1" id="chatMessageInput" placeholder="Escribe un mensaje...">
                                    <button class="btn btn-link p-0 ms-2" onclick="sendChatMessage()">
                                        <i class="bi bi-send-fill fs-5 text-brand-blue"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Offcanvas - Detalles del Ticket -->
                            <div class="offcanvas offcanvas-end" tabindex="-1" id="ticketDetailsOffcanvas" aria-labelledby="ticketDetailsLabel" style="width: 400px;">
                                <div class="offcanvas-header border-bottom" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                                    <h5 class="offcanvas-title fw-bold title-gradient" id="ticketDetailsLabel">Información del Ticket</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                                </div>
                                <div class="offcanvas-body p-0">
                                    
                                    <!-- Información General -->
                                    <div class="p-4 border-bottom">
                                        <h6 class="text-muted text-uppercase small fw-bold mb-3">Detalles</h6>
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="text-muted small">Ticket ID:</span>
                                                <span class="fw-bold text-brand-blue">#1001</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="text-muted small">Estado:</span>
                                                <span class="badge bg-warning text-dark">Pendiente</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="text-muted small">Prioridad:</span>
                                                <span class="badge bg-danger">Alta</span>
                                            </div>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="text-muted small">Creado:</span>
                                                <span class="small">11/12/2025 10:30</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="text-muted small fw-bold mb-2">Asunto</label>
                                            <p class="mb-0">Problema con acceso al sistema</p>
                                        </div>
                                    </div>

                                    <!-- Operadores de Soporte -->
                                    <div class="p-4 border-bottom">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6 class="text-muted text-uppercase small fw-bold mb-0">Equipo de Soporte</h6>
                                            <button class="btn btn-sm rounded-pill" style="background: var(--brand-gradient); color: white; border: none;">
                                                <i class="bi bi-plus-circle me-1"></i> Agregar
                                            </button>
                                        </div>
                                        <div class="participant-list">
                                            <div class="participant-item">
                                                <div class="participant-avatar bg-primary">
                                                    <i class="bi bi-person-fill"></i>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <div class="fw-semibold">María González</div>
                                                    <small class="text-muted">Operador Principal</small>
                                                </div>
                                                <span class="badge bg-success-subtle text-success">Activo</span>
                                            </div>
                                            <div class="participant-item">
                                                <div class="participant-avatar bg-info">
                                                    <i class="bi bi-person-fill"></i>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <div class="fw-semibold">Carlos Ruiz</div>
                                                    <small class="text-muted">Supervisor</small>
                                                </div>
                                                <span class="badge bg-secondary-subtle text-secondary">Observador</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Usuarios Involucrados -->
                                    <div class="p-4 border-bottom">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6 class="text-muted text-uppercase small fw-bold mb-0">Usuarios</h6>
                                            <button class="btn btn-sm rounded-pill" style="background: var(--brand-gradient); color: white; border: none;">
                                                <i class="bi bi-plus-circle me-1"></i> Agregar
                                            </button>
                                        </div>
                                        <div class="participant-list">
                                            <div class="participant-item">
                                                <div class="participant-avatar bg-success">
                                                    <i class="bi bi-person-circle"></i>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <div class="fw-semibold">Juan Pérez</div>
                                                    <small class="text-muted">Solicitante Principal</small>
                                                </div>
                                            </div>
                                            <div class="participant-item">
                                                <div class="participant-avatar bg-warning">
                                                    <i class="bi bi-person-circle"></i>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <div class="fw-semibold">Ana Martínez</div>
                                                    <small class="text-muted">En copia</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Archivos Adjuntos -->
                                    <div class="p-4 border-bottom">
                                        <h6 class="text-muted text-uppercase small fw-bold mb-3">Archivos Adjuntos</h6>
                                        <div class="row g-2">
                                            <div class="col-4">
                                                <div class="attachment-item">
                                                    <i class="bi bi-file-earmark-image text-primary"></i>
                                                    <small class="d-block text-truncate">captura.png</small>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="attachment-item">
                                                    <i class="bi bi-file-earmark-pdf text-danger"></i>
                                                    <small class="d-block text-truncate">reporte.pdf</small>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="attachment-item">
                                                    <i class="bi bi-file-earmark-text text-info"></i>
                                                    <small class="d-block text-truncate">logs.txt</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Acciones Rápidas -->
                                    <div class="p-4">
                                        <h6 class="text-muted text-uppercase small fw-bold mb-3">Acciones</h6>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-outline-primary btn-sm text-start">
                                                <i class="bi bi-check-circle me-2"></i> Cambiar Estado
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm text-start">
                                                <i class="bi bi-flag me-2"></i> Cambiar Prioridad
                                            </button>
                                            <button class="btn btn-outline-danger btn-sm text-start">
                                                <i class="bi bi-x-circle me-2"></i> Cerrar Ticket
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="config" role="tabpanel">
                            <!-- Mobile Header - Solo en Config (sin botones) -->
                            <div class="d-md-none d-flex justify-content-between align-items-center mb-3 px-3 pt-3">
                                <h4 class="fw-bold text-brand-blue mb-0">Configuración</h4>
                            </div>
                            
                            <h2 class="fw-bold mb-4 title-gradient d-none d-md-block">Configuración</h2>
                            
                            <!-- Perfil de Usuario -->
                            <div class="card border-0 shadow-sm rounded-4 mb-4 card-hover">
                                <div class="card-body p-4">
                                    <div class="d-flex align-items-center mb-4">
                                        <div class="user-avatar-container me-3">
                                            <div class="user-avatar">
                                                <i class="bi bi-person-fill"></i>
                                            </div>
                                            <span class="user-status online" title="En línea"></span>
                                        </div>
                                        <div>
                                            <h5 class="mb-0 fw-bold text-brand-blue">María González</h5>
                                            <p class="text-muted mb-0 small">Operador de Soporte</p>
                                            <span class="badge bg-success rounded-pill mt-1" style="font-size: 0.65rem;">
                                                <i class="bi bi-circle-fill me-1" style="font-size: 6px;"></i>En línea
                                            </span>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-ripple w-100 rounded-pill mb-2" style="background: var(--brand-gradient); border: none;" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                                        <i class="bi bi-pencil-square me-2"></i> Editar Perfil
                                    </button>
                                    <button class="btn btn-outline-secondary btn-ripple w-100 rounded-pill btn-change-password" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                                        <i class="bi bi-shield-lock me-2"></i> Cambiar Contraseña
                                    </button>
                                </div>
                            </div>

                            <!-- Preferencias -->
                            <div class="card border-0 shadow-sm rounded-4 mb-4 card-hover">
                                <div class="card-body p-4">
                                    <h6 class="fw-bold text-brand-blue mb-3">
                                        <i class="bi bi-sliders me-2"></i> Preferencias
                                    </h6>
                                    <div class="mb-3">
                                        <label class="form-label small text-muted mb-2">Notificaciones</label>
                                        <div class="form-check form-switch d-flex align-items-center mb-2">
                                            <input class="form-check-input me-3" type="checkbox" role="switch" id="notifEmail" checked>
                                            <label class="form-check-label" for="notifEmail">Notificaciones por email</label>
                                        </div>
                                        <div class="form-check form-switch d-flex align-items-center">
                                            <input class="form-check-input me-3" type="checkbox" role="switch" id="notifSound" checked>
                                            <label class="form-check-label" for="notifSound">Sonido de notificaciones</label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="form-label small text-muted">Tema</label>
                                        <select class="form-select" id="themeSelector" onchange="changeTheme(this.value)">
                                            <option value="light" selected>Claro</option>
                                            <option value="dark">Oscuro</option>
                                            <option value="auto">Automático</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Información del Sistema -->
                            <div class="card border-0 shadow-sm rounded-4 mb-4 card-hover">
                                <div class="card-body p-4">
                                    <h6 class="fw-bold text-brand-blue mb-3">
                                        <i class="bi bi-info-circle me-2"></i> Información
                                    </h6>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span class="text-muted small">Versión:</span>
                                        <span class="fw-semibold small">1.0.0</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span class="text-muted small">Última actualización:</span>
                                        <span class="fw-semibold small">11/12/2025</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Botón de Cerrar Sesión -->
                            <div class="d-grid pb-4 mb-5">
                                <button class="btn btn-danger rounded-pill py-3" data-bs-toggle="modal" data-bs-target="#logoutModal">
                                    <i class="bi bi-box-arrow-left me-2"></i> Cerrar Sesión
                                </button>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Logout -->
    <div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold text-brand-blue">Confirmar salida</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <i class="bi bi-exclamation-circle text-danger display-1 mb-3"></i>
                    <p class="mb-0 fs-5">¿Estás seguro que quieres cerrar tu sesión?</p>
                </div>
                <div class="modal-footer border-0 justify-content-center pb-4">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
                    <a href="{{ url_for('login_bp.root') }}" class="btn btn-danger rounded-pill px-4">Sí, salir</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Editar Perfil -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-pencil-square me-2"></i>Editar Perfil
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Nombre Completo</label>
                        <input type="text" class="form-control" value="María González">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Email</label>
                        <input type="email" class="form-control" value="maria.gonzalez@clubrecrear.com">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Teléfono</label>
                        <input type="tel" class="form-control" value="+57 300 123 4567">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Cargo</label>
                        <input type="text" class="form-control" value="Operador de Soporte">
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary rounded-pill px-4" style="background: var(--brand-gradient); border:none;">
                        <i class="bi bi-check-lg me-1"></i> Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cambiar Contraseña -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-shield-lock me-2"></i>Cambiar Contraseña
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Contraseña Actual</label>
                        <input type="password" class="form-control" placeholder="Ingresa tu contraseña actual">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Nueva Contraseña</label>
                        <input type="password" class="form-control" placeholder="Ingresa tu nueva contraseña">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Confirmar Nueva Contraseña</label>
                        <input type="password" class="form-control" placeholder="Confirma tu nueva contraseña">
                    </div>
                    <div class="alert alert-info d-flex align-items-center" role="alert">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <small>La contraseña debe tener al menos 8 caracteres</small>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary rounded-pill px-4" style="background: var(--brand-gradient); border:none;">
                        <i class="bi bi-check-lg me-1"></i> Cambiar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Nuevo Ticket -->
    <div class="modal fade" id="newTicketModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-plus-circle-fill me-2"></i>Crear Nuevo Ticket
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="newTicketForm">
                        <!-- Asunto -->
                        <div class="mb-3">
                            <label for="ticketSubject" class="form-label fw-semibold text-brand-blue">
                                Asunto <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="ticketSubject" placeholder="Describe brevemente el problema" required>
                        </div>

                        <!-- Descripción -->
                        <div class="mb-3">
                            <label for="ticketDescription" class="form-label fw-semibold text-brand-blue">
                                Descripción <span class="text-danger">*</span>
                            </label>
                            <textarea class="form-control" id="ticketDescription" rows="4" placeholder="Proporciona detalles sobre el problema o solicitud..." required></textarea>
                        </div>

                        <div class="row">
                            <!-- Prioridad -->
                            <div class="col-md-6 mb-3">
                                <label for="ticketPriority" class="form-label fw-semibold text-brand-blue">
                                    Prioridad <span class="text-danger">*</span>
                                </label>
                                <select class="form-select" id="ticketPriority" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="baja">Baja</option>
                                    <option value="media" selected>Media</option>
                                    <option value="alta">Alta</option>
                                    <option value="critica">Crítica</option>
                                </select>
                            </div>

                            <!-- Categoría -->
                            <div class="col-md-6 mb-3">
                                <label for="ticketCategory" class="form-label fw-semibold text-brand-blue">
                                    Categoría <span class="text-danger">*</span>
                                </label>
                                <select class="form-select" id="ticketCategory" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="tecnico">Soporte Técnico</option>
                                    <option value="cuenta">Cuenta y Acceso</option>
                                    <option value="pagos">Pagos y Facturación</option>
                                    <option value="membresia">Membresía</option>
                                    <option value="general">Consulta General</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                        </div>

                        <!-- Usuario afectado (solo si es operador) -->
                        <div class="mb-3">
                            <label for="ticketUser" class="form-label fw-semibold text-brand-blue">
                                Usuario afectado
                            </label>
                            <input type="text" class="form-control" id="ticketUser" placeholder="Nombre del usuario (opcional)">
                            <small class="text-muted">Si creas el ticket para otro usuario, indica su nombre o email</small>
                        </div>

                        <!-- Archivos adjuntos -->
                        <div class="mb-3">
                            <label for="ticketAttachments" class="form-label fw-semibold text-brand-blue">
                                Archivos adjuntos
                            </label>
                            <input type="file" class="form-control" id="ticketAttachments" multiple>
                            <small class="text-muted">Puedes adjuntar capturas de pantalla, documentos o archivos relacionados (máx. 5 archivos, 10MB cada uno)</small>
                        </div>

                        <!-- Vista previa de archivos -->
                        <div id="attachmentPreview" class="mb-3" style="display: none;">
                            <label class="form-label fw-semibold text-brand-blue">Archivos seleccionados:</label>
                            <div id="attachmentList" class="d-flex flex-wrap gap-2"></div>
                        </div>

                        <div class="alert alert-info d-flex align-items-start" role="alert">
                            <i class="bi bi-info-circle-fill me-2 mt-1"></i>
                            <small>Los campos marcados con <span class="text-danger">*</span> son obligatorios. Un operador de soporte te responderá lo antes posible.</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary rounded-pill px-4" style="background: var(--brand-gradient); border:none;" onclick="createTicket()">
                        <i class="bi bi-send-fill me-1"></i> Crear Ticket
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Búsqueda de Tickets -->
    <div class="modal fade" id="searchTicketsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header border-0 pb-2" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <div class="w-100">
                        <div class="input-group">
                            <span class="input-group-text bg-transparent border-0">
                                <i class="bi bi-search text-brand-blue"></i>
                            </span>
                            <input type="text" class="form-control border-0 shadow-none" id="searchTicketInput" placeholder="Buscar tickets por ID, asunto, usuario..." autofocus>
                            <button type="button" class="btn-close ms-2" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                        </div>
                    </div>
                </div>
                <div class="modal-body p-0" style="max-height: 60vh; overflow-y: auto;">
                    <div id="searchResults">
                        <!-- Resultados de búsqueda aparecerán aquí -->
                        <div class="text-center py-5 text-muted">
                            <i class="bi bi-search display-4 d-block mb-3 opacity-25"></i>
                            <p>Comienza a escribir para buscar tickets...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Filtros -->
    <div class="modal fade" id="filtersModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-funnel-fill me-2"></i>Filtrar Tickets
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <!-- Estado -->
                    <div class="mb-4">
                        <label class="form-label fw-semibold text-brand-blue">Estado</label>
                        <div class="d-flex flex-wrap gap-2">
                            <input type="checkbox" class="btn-check" id="filter-all" checked>
                            <label class="btn btn-outline-primary btn-sm rounded-pill" for="filter-all">Todos</label>
                            
                            <input type="checkbox" class="btn-check" id="filter-open">
                            <label class="btn btn-outline-primary btn-sm rounded-pill" for="filter-open">Abiertos</label>
                            
                            <input type="checkbox" class="btn-check" id="filter-pending">
                            <label class="btn btn-outline-warning btn-sm rounded-pill" for="filter-pending">Pendientes</label>
                            
                            <input type="checkbox" class="btn-check" id="filter-closed">
                            <label class="btn btn-outline-success btn-sm rounded-pill" for="filter-closed">Cerrados</label>
                        </div>
                    </div>

                    <!-- Prioridad -->
                    <div class="mb-4">
                        <label class="form-label fw-semibold text-brand-blue">Prioridad</label>
                        <div class="d-flex flex-wrap gap-2">
                            <input type="checkbox" class="btn-check" id="priority-high">
                            <label class="btn btn-outline-danger btn-sm rounded-pill" for="priority-high">Alta</label>
                            
                            <input type="checkbox" class="btn-check" id="priority-medium">
                            <label class="btn btn-outline-warning btn-sm rounded-pill" for="priority-medium">Media</label>
                            
                            <input type="checkbox" class="btn-check" id="priority-low">
                            <label class="btn btn-outline-info btn-sm rounded-pill" for="priority-low">Baja</label>
                        </div>
                    </div>

                    <!-- Rango de fechas -->
                    <div class="mb-4">
                        <label class="form-label fw-semibold text-brand-blue">Fecha de creación</label>
                        <div class="row g-2">
                            <div class="col-6">
                                <input type="date" class="form-control" placeholder="Desde">
                            </div>
                            <div class="col-6">
                                <input type="date" class="form-control" placeholder="Hasta">
                            </div>
                        </div>
                    </div>

                    <!-- Asignado a -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Asignado a</label>
                        <select class="form-select">
                            <option value="">Todos los operadores</option>
                            <option value="1">María González</option>
                            <option value="2">Carlos Ruiz</option>
                            <option value="3">Ana Martínez</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-between">
                    <button type="button" class="btn btn-link text-muted" onclick="resetFilters()">
                        <i class="bi bi-arrow-counterclockwise me-1"></i> Limpiar filtros
                    </button>
                    <div>
                        <button type="button" class="btn btn-light rounded-pill px-4 me-2" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary rounded-pill px-4" style="background: var(--brand-gradient); border:none;" onclick="applyFilters()">
                            <i class="bi bi-check-lg me-1"></i> Aplicar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Offcanvas de Solicitudes Pendientes -->
    <div class="offcanvas offcanvas-end offcanvas-solicitudes" tabindex="-1" id="solicitudesOffcanvas" aria-labelledby="solicitudesOffcanvasLabel">
        <div class="offcanvas-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.08), rgba(0, 156, 180, 0.08));">
            <div>
                <h5 class="offcanvas-title fw-bold title-gradient" id="solicitudesOffcanvasLabel">
                    <i class="bi bi-inbox-fill me-2"></i>Solicitudes Pendientes
                </h5>
                <small class="text-muted">Tickets que esperan tu aprobación</small>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
        </div>
        <div class="offcanvas-body p-3" style="background: #f8f9fa;">
            <!-- Filtros rápidos -->
            <div class="d-flex gap-2 mb-3 flex-wrap">
                <button class="btn btn-sm btn-primary rounded-pill active" onclick="filterSolicitudes('todas')">Todas</button>
                <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="filterSolicitudes('critica')">Críticas</button>
                <button class="btn btn-sm btn-outline-warning rounded-pill" onclick="filterSolicitudes('alta')">Alta</button>
                <button class="btn btn-sm btn-outline-secondary rounded-pill" onclick="filterSolicitudes('media')">Media</button>
            </div>

            <!-- Lista de solicitudes -->
            <div id="solicitudesList">
                <!-- Solicitud 1 - Crítica -->
                <div class="solicitud-card" data-prioridad="critica" data-id="2001">
                    <div class="solicitud-header">
                        <div class="solicitud-avatar">
                            <i class="bi bi-person"></i>
                        </div>
                        <div class="solicitud-info">
                            <h6 class="solicitud-titulo">Sistema caído completamente</h6>
                            <p class="solicitud-usuario"><i class="bi bi-person me-1"></i>Roberto Méndez</p>
                        </div>
                    </div>
                    <div class="solicitud-meta">
                        <span class="badge prioridad-critica">Crítica</span>
                        <span class="badge bg-secondary">Soporte Técnico</span>
                        <small class="text-muted"><i class="bi bi-clock me-1"></i>Hace 5 min</small>
                    </div>
                    <p class="solicitud-descripcion">
                        El sistema principal no está funcionando desde esta mañana. Ningún usuario puede acceder y estamos perdiendo operaciones importantes...
                    </p>
                    <div class="solicitud-acciones">
                        <button class="btn-aceptar" onclick="aceptarSolicitud('2001')">
                            <i class="bi bi-check-lg me-1"></i>Aceptar
                        </button>
                        <button class="btn-rechazar" onclick="rechazarSolicitud('2001')">
                            <i class="bi bi-x-lg me-1"></i>Rechazar
                        </button>
                        <button class="btn-ver-detalle" onclick="verDetalleSolicitud('2001')" title="Ver detalles">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                </div>

                <!-- Solicitud 2 - Alta -->
                <div class="solicitud-card" data-prioridad="alta" data-id="2002">
                    <div class="solicitud-header">
                        <div class="solicitud-avatar">
                            <i class="bi bi-person"></i>
                        </div>
                        <div class="solicitud-info">
                            <h6 class="solicitud-titulo">No puedo procesar pagos</h6>
                            <p class="solicitud-usuario"><i class="bi bi-person me-1"></i>Carolina Vega</p>
                        </div>
                    </div>
                    <div class="solicitud-meta">
                        <span class="badge prioridad-alta">Alta</span>
                        <span class="badge bg-secondary">Pagos</span>
                        <small class="text-muted"><i class="bi bi-clock me-1"></i>Hace 15 min</small>
                    </div>
                    <p class="solicitud-descripcion">
                        Cuando intento realizar un pago el sistema muestra error 500. Adjunto captura de pantalla del problema.
                    </p>
                    <div class="solicitud-acciones">
                        <button class="btn-aceptar" onclick="aceptarSolicitud('2002')">
                            <i class="bi bi-check-lg me-1"></i>Aceptar
                        </button>
                        <button class="btn-rechazar" onclick="rechazarSolicitud('2002')">
                            <i class="bi bi-x-lg me-1"></i>Rechazar
                        </button>
                        <button class="btn-ver-detalle" onclick="verDetalleSolicitud('2002')" title="Ver detalles">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                </div>

                <!-- Solicitud 3 - Media -->
                <div class="solicitud-card" data-prioridad="media" data-id="2003">
                    <div class="solicitud-header">
                        <div class="solicitud-avatar">
                            <i class="bi bi-person"></i>
                        </div>
                        <div class="solicitud-info">
                            <h6 class="solicitud-titulo">Actualizar datos de membresía</h6>
                            <p class="solicitud-usuario"><i class="bi bi-person me-1"></i>Luis Fernández</p>
                        </div>
                    </div>
                    <div class="solicitud-meta">
                        <span class="badge prioridad-media">Media</span>
                        <span class="badge bg-secondary">Membresía</span>
                        <small class="text-muted"><i class="bi bi-clock me-1"></i>Hace 1 hora</small>
                    </div>
                    <p class="solicitud-descripcion">
                        Necesito cambiar mi dirección de correo electrónico asociada a mi cuenta de membresía premium.
                    </p>
                    <div class="solicitud-acciones">
                        <button class="btn-aceptar" onclick="aceptarSolicitud('2003')">
                            <i class="bi bi-check-lg me-1"></i>Aceptar
                        </button>
                        <button class="btn-rechazar" onclick="rechazarSolicitud('2003')">
                            <i class="bi bi-x-lg me-1"></i>Rechazar
                        </button>
                        <button class="btn-ver-detalle" onclick="verDetalleSolicitud('2003')" title="Ver detalles">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Estado vacío -->
            <div class="solicitudes-empty d-none" id="solicitudesEmpty">
                <i class="bi bi-inbox"></i>
                <h6 class="fw-bold">No hay solicitudes pendientes</h6>
                <p class="small text-muted">Cuando lleguen nuevas solicitudes de tickets, aparecerán aquí.</p>
            </div>
        </div>
        
        <!-- Footer del offcanvas -->
        <div class="offcanvas-footer p-3 border-top bg-white">
            <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">
                    <span id="solicitudesCount">3</span> solicitudes pendientes
                </small>
                <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="actualizarSolicitudes()">
                    <i class="bi bi-arrow-clockwise me-1"></i>Actualizar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Detalle de Solicitud -->
    <div class="modal fade" id="detalleSolicitudModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-ticket-detailed me-2"></i>Detalle de Solicitud
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row">
                        <div class="col-md-8">
                            <h5 class="fw-bold text-brand-blue mb-3" id="detalleSolicitudTitulo">Sistema caído completamente</h5>
                            <div class="mb-3" id="detalleSolicitudDescripcion">
                                <p>El sistema principal no está funcionando desde esta mañana. Ningún usuario puede acceder y estamos perdiendo operaciones importantes.</p>
                                <p>Ya intentamos reiniciar los servidores pero el problema persiste. Necesitamos asistencia urgente.</p>
                            </div>
                            
                            <!-- Archivos adjuntos de la solicitud -->
                            <div class="mb-3" id="detalleSolicitudAdjuntos">
                                <h6 class="text-muted small fw-bold mb-2">Archivos Adjuntos</h6>
                                <div class="d-flex flex-wrap gap-2">
                                    <div class="badge bg-light text-dark border p-2 d-flex align-items-center gap-2">
                                        <i class="bi bi-file-earmark-image text-primary"></i>
                                        <span>error_screenshot.png</span>
                                    </div>
                                    <div class="badge bg-light text-dark border p-2 d-flex align-items-center gap-2">
                                        <i class="bi bi-file-earmark-text text-info"></i>
                                        <span>logs.txt</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-0 bg-light rounded-3 p-3">
                                <h6 class="text-muted small fw-bold mb-3">Información</h6>
                                <div class="mb-2">
                                    <small class="text-muted d-block">Solicitante</small>
                                    <span class="fw-semibold" id="detalleSolicitudUsuario">Roberto Méndez</span>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted d-block">Email</small>
                                    <span class="fw-semibold" id="detalleSolicitudEmail">roberto@email.com</span>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted d-block">Prioridad</small>
                                    <span class="badge prioridad-critica" id="detalleSolicitudPrioridad">Crítica</span>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted d-block">Categoría</small>
                                    <span id="detalleSolicitudCategoria">Soporte Técnico</span>
                                </div>
                                <div class="mb-2">
                                    <small class="text-muted d-block">Fecha de solicitud</small>
                                    <span id="detalleSolicitudFecha">12/12/2025, 10:30</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-between">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn-rechazar px-4" onclick="rechazarDesdeDetalle()">
                            <i class="bi bi-x-lg me-1"></i>Rechazar
                        </button>
                        <button type="button" class="btn-aceptar px-4" onclick="aceptarDesdeDetalle()">
                            <i class="bi bi-check-lg me-1"></i>Aceptar y Crear Ticket
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Rechazo de Solicitud -->
    <div class="modal fade" id="rechazarSolicitudModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(220, 53, 69, 0.05), rgba(220, 53, 69, 0.1));">
                    <h5 class="modal-title fw-bold text-danger">
                        <i class="bi bi-x-circle me-2"></i>Rechazar Solicitud
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <p class="text-muted mb-3">Por favor, indica el motivo del rechazo. El solicitante recibirá esta información por correo.</p>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Motivo del rechazo <span class="text-danger">*</span></label>
                        <select class="form-select mb-2" id="motivoRechazoSelect">
                            <option value="">Seleccionar motivo...</option>
                            <option value="duplicado">Ticket duplicado</option>
                            <option value="informacion">Información insuficiente</option>
                            <option value="fuera-alcance">Fuera del alcance de soporte</option>
                            <option value="resuelto">Ya fue resuelto</option>
                            <option value="otro">Otro motivo</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Comentario adicional</label>
                        <textarea class="form-control" id="comentarioRechazo" rows="3" placeholder="Proporciona más detalles si es necesario..."></textarea>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger rounded-pill px-4" onclick="confirmarRechazo()">
                        <i class="bi bi-x-lg me-1"></i>Confirmar Rechazo
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Reportes -->
    <div class="modal fade" id="reportModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-file-earmark-bar-graph me-2"></i>Reportes y Estadísticas
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <!-- Filtros de reporte -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <label class="form-label small text-muted">Rango de fechas</label>
                            <select class="form-select" id="reportDateRange">
                                <option value="today">Hoy</option>
                                <option value="week" selected>Última semana</option>
                                <option value="month">Último mes</option>
                                <option value="quarter">Último trimestre</option>
                                <option value="custom">Personalizado</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small text-muted">Categoría</label>
                            <select class="form-select">
                                <option value="">Todas</option>
                                <option value="tech">Soporte Técnico</option>
                                <option value="account">Cuenta y Acceso</option>
                                <option value="payments">Pagos</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small text-muted">Operador</label>
                            <select class="form-select">
                                <option value="">Todos</option>
                                <option value="1">María González</option>
                                <option value="2">Carlos Ruiz</option>
                                <option value="3">Ana Martínez</option>
                            </select>
                        </div>
                        <div class="col-md-3 d-flex align-items-end">
                            <button class="btn btn-primary w-100" style="background: var(--brand-gradient); border: none;">
                                <i class="bi bi-funnel me-1"></i> Aplicar Filtros
                            </button>
                        </div>
                    </div>

                    <!-- Resumen de estadísticas -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <div class="p-3 rounded-3 bg-light text-center">
                                <div class="fs-3 fw-bold text-brand-blue">156</div>
                                <div class="small text-muted">Total Tickets</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 rounded-3 bg-light text-center">
                                <div class="fs-3 fw-bold text-success">142</div>
                                <div class="small text-muted">Resueltos</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 rounded-3 bg-light text-center">
                                <div class="fs-3 fw-bold text-warning">2.8h</div>
                                <div class="small text-muted">Tiempo Promedio</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 rounded-3 bg-light text-center">
                                <div class="fs-3 fw-bold text-info">91%</div>
                                <div class="small text-muted">Satisfacción</div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráficos simulados -->
                    <div class="row g-4">
                        <div class="col-md-8">
                            <div class="p-3 rounded-3 border">
                                <h6 class="fw-bold mb-3">Tickets por Día</h6>
                                <div class="d-flex align-items-end justify-content-between" style="height: 150px;">
                                    <div class="text-center flex-fill">
                                        <div class="mx-1 rounded-top" style="height: 80px; background: var(--brand-gradient);"></div>
                                        <small class="text-muted">Lun</small>
                                    </div>
                                    <div class="text-center flex-fill">
                                        <div class="mx-1 rounded-top" style="height: 120px; background: var(--brand-gradient);"></div>
                                        <small class="text-muted">Mar</small>
                                    </div>
                                    <div class="text-center flex-fill">
                                        <div class="mx-1 rounded-top" style="height: 95px; background: var(--brand-gradient);"></div>
                                        <small class="text-muted">Mié</small>
                                    </div>
                                    <div class="text-center flex-fill">
                                        <div class="mx-1 rounded-top" style="height: 140px; background: var(--brand-gradient);"></div>
                                        <small class="text-muted">Jue</small>
                                    </div>
                                    <div class="text-center flex-fill">
                                        <div class="mx-1 rounded-top" style="height: 110px; background: var(--brand-gradient);"></div>
                                        <small class="text-muted">Vie</small>
                                    </div>
                                    <div class="text-center flex-fill">
                                        <div class="mx-1 rounded-top" style="height: 60px; background: rgba(0,156,180,0.5);"></div>
                                        <small class="text-muted">Sáb</small>
                                    </div>
                                    <div class="text-center flex-fill">
                                        <div class="mx-1 rounded-top" style="height: 40px; background: rgba(0,156,180,0.5);"></div>
                                        <small class="text-muted">Dom</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="p-3 rounded-3 border h-100">
                                <h6 class="fw-bold mb-3">Por Categoría</h6>
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between small mb-1">
                                        <span>Soporte Técnico</span>
                                        <span class="fw-bold">45%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" style="width: 45%; background: #007bff;"></div>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between small mb-1">
                                        <span>Cuenta y Acceso</span>
                                        <span class="fw-bold">25%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" style="width: 25%; background: #6f42c1;"></div>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between small mb-1">
                                        <span>Pagos</span>
                                        <span class="fw-bold">20%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" style="width: 20%; background: #28a745;"></div>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between small mb-1">
                                        <span>Otros</span>
                                        <span class="fw-bold">10%</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" style="width: 10%; background: #fd7e14;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-primary rounded-pill px-4">
                        <i class="bi bi-file-earmark-pdf me-1"></i> Exportar PDF
                    </button>
                    <button type="button" class="btn btn-outline-success rounded-pill px-4">
                        <i class="bi bi-file-earmark-excel me-1"></i> Exportar Excel
                    </button>
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Base de Conocimiento -->
    <div class="modal fade" id="knowledgeBaseModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-book me-2"></i>Base de Conocimiento
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <!-- Buscador -->
                    <div class="input-group mb-4">
                        <span class="input-group-text bg-white"><i class="bi bi-search text-muted"></i></span>
                        <input type="text" class="form-control" id="kbSearchInput" placeholder="Buscar artículos...">
                    </div>

                    <!-- Categorías -->
                    <div class="row g-4" id="kbCategories">
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm rounded-3 h-100">
                                <div class="card-header bg-transparent d-flex align-items-center gap-2 py-3">
                                    <div class="kb-icon tech" style="width: 35px; height: 35px; font-size: 1rem; margin: 0;">
                                        <i class="bi bi-gear-wide-connected"></i>
                                    </div>
                                    <h6 class="mb-0 fw-bold">Soporte Técnico</h6>
                                </div>
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush">
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-1')">
                                            <div class="fw-semibold">¿Cómo restablecer mi contraseña?</div>
                                            <small class="text-muted">Pasos para recuperar el acceso a tu cuenta</small>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-2')">
                                            <div class="fw-semibold">Problemas con el inicio de sesión</div>
                                            <small class="text-muted">Soluciones comunes para errores de acceso</small>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-3')">
                                            <div class="fw-semibold">Error de conexión al servidor</div>
                                            <small class="text-muted">Qué hacer cuando no puedes conectarte</small>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm rounded-3 h-100">
                                <div class="card-header bg-transparent d-flex align-items-center gap-2 py-3">
                                    <div class="kb-icon payments" style="width: 35px; height: 35px; font-size: 1rem; margin: 0;">
                                        <i class="bi bi-credit-card"></i>
                                    </div>
                                    <h6 class="mb-0 fw-bold">Pagos y Facturación</h6>
                                </div>
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush">
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-4')">
                                            <div class="fw-semibold">Métodos de pago aceptados</div>
                                            <small class="text-muted">Tarjetas, transferencias y otros métodos</small>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-5')">
                                            <div class="fw-semibold">¿Cómo solicitar un reembolso?</div>
                                            <small class="text-muted">Proceso y tiempos de devolución</small>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-6')">
                                            <div class="fw-semibold">Descargar facturas</div>
                                            <small class="text-muted">Accede a tu historial de facturación</small>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm rounded-3 h-100">
                                <div class="card-header bg-transparent d-flex align-items-center gap-2 py-3">
                                    <div class="kb-icon account" style="width: 35px; height: 35px; font-size: 1rem; margin: 0;">
                                        <i class="bi bi-person-badge"></i>
                                    </div>
                                    <h6 class="mb-0 fw-bold">Cuenta y Acceso</h6>
                                </div>
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush">
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-7')">
                                            <div class="fw-semibold">Actualizar datos personales</div>
                                            <small class="text-muted">Cómo modificar tu información de perfil</small>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-8')">
                                            <div class="fw-semibold">Cambiar mi correo electrónico</div>
                                            <small class="text-muted">Pasos para actualizar tu email</small>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-9')">
                                            <div class="fw-semibold">Eliminar mi cuenta</div>
                                            <small class="text-muted">Proceso de baja definitiva</small>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm rounded-3 h-100">
                                <div class="card-header bg-transparent d-flex align-items-center gap-2 py-3">
                                    <div class="kb-icon general" style="width: 35px; height: 35px; font-size: 1rem; margin: 0;">
                                        <i class="bi bi-question-circle"></i>
                                    </div>
                                    <h6 class="mb-0 fw-bold">Preguntas Frecuentes</h6>
                                </div>
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush">
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-10')">
                                            <div class="fw-semibold">Horarios de atención</div>
                                            <small class="text-muted">Cuándo estamos disponibles para ayudarte</small>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-11')">
                                            <div class="fw-semibold">Tiempos de respuesta</div>
                                            <small class="text-muted">Cuánto tardamos en responder tu ticket</small>
                                        </a>
                                        <a href="#" class="list-group-item list-group-item-action py-3" onclick="openKBArticle('kb-12')">
                                            <div class="fw-semibold">Política de privacidad</div>
                                            <small class="text-muted">Cómo protegemos tus datos</small>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-primary rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#newArticleModal">
                        <i class="bi bi-plus-lg me-1"></i> Nuevo Artículo
                    </button>
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Historial de Auditoría -->
    <div class="modal fade" id="auditHistoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-clock-history me-2"></i>Historial del Ticket <span id="auditTicketId">#1001</span>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="audit-timeline" id="auditTimelineContent">
                        <div class="audit-item action-create">
                            <div class="audit-time">12/12/2025, 10:30</div>
                            <div class="audit-action">Ticket creado</div>
                            <div class="audit-user">por Juan Pérez</div>
                            <div class="audit-details">
                                <strong>Asunto:</strong> Problema con acceso al sistema<br>
                                <strong>Prioridad:</strong> Alta<br>
                                <strong>Categoría:</strong> Soporte Técnico
                            </div>
                        </div>
                        <div class="audit-item action-assign">
                            <div class="audit-time">12/12/2025, 10:35</div>
                            <div class="audit-action">Ticket asignado</div>
                            <div class="audit-user">a María González</div>
                            <div class="audit-details">
                                Asignación automática basada en disponibilidad
                            </div>
                        </div>
                        <div class="audit-item action-update">
                            <div class="audit-time">12/12/2025, 10:45</div>
                            <div class="audit-action">Estado cambiado a "En Proceso"</div>
                            <div class="audit-user">por María González</div>
                        </div>
                        <div class="audit-item action-update">
                            <div class="audit-time">12/12/2025, 11:00</div>
                            <div class="audit-action">Respuesta enviada</div>
                            <div class="audit-user">por María González</div>
                            <div class="audit-details">
                                "Hola Juan, estamos revisando el problema..."
                            </div>
                        </div>
                        <div class="audit-item action-update">
                            <div class="audit-time">12/12/2025, 11:30</div>
                            <div class="audit-action">Archivo adjuntado</div>
                            <div class="audit-user">por Juan Pérez</div>
                            <div class="audit-details">
                                screenshot_error.png (245 KB)
                            </div>
                        </div>
                        <div class="audit-item action-update">
                            <div class="audit-time">12/12/2025, 12:00</div>
                            <div class="audit-action">Prioridad cambiada</div>
                            <div class="audit-user">por María González</div>
                            <div class="audit-details">
                                De "Alta" a "Crítica" - Afecta a múltiples usuarios
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-primary rounded-pill px-4" onclick="exportAuditHistory()">
                        <i class="bi bi-download me-1"></i> Exportar
                    </button>
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Respuestas Predefinidas -->
    <div class="modal fade" id="quickRepliesModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-lightning-fill me-2"></i>Respuestas Predefinidas
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <!-- Buscador -->
                    <div class="input-group mb-4">
                        <span class="input-group-text bg-white"><i class="bi bi-search text-muted"></i></span>
                        <input type="text" class="form-control" id="quickReplySearch" placeholder="Buscar respuestas...">
                    </div>

                    <!-- Lista de respuestas -->
                    <div class="list-group" id="quickRepliesList">
                        <div class="list-group-item list-group-item-action p-3" onclick="selectQuickReply('saludo')">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1 fw-bold text-brand-blue">Saludo Inicial</h6>
                                    <p class="mb-1 text-muted small">Hola $nombre, gracias por contactarnos. Mi nombre es $operador y estaré ayudándote con tu solicitud...</p>
                                </div>
                                <span class="badge bg-light text-dark">General</span>
                            </div>
                        </div>
                        <div class="list-group-item list-group-item-action p-3" onclick="selectQuickReply('seguimiento')">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1 fw-bold text-brand-blue">Solicitar Información</h6>
                                    <p class="mb-1 text-muted small">Para poder ayudarte mejor, necesito que me proporciones la siguiente información...</p>
                                </div>
                                <span class="badge bg-light text-dark">Seguimiento</span>
                            </div>
                        </div>
                        <div class="list-group-item list-group-item-action p-3" onclick="selectQuickReply('password')">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1 fw-bold text-brand-blue">Reset de Contraseña</h6>
                                    <p class="mb-1 text-muted small">Hemos enviado un enlace de recuperación a tu correo electrónico. Por favor revisa tu bandeja de entrada...</p>
                                </div>
                                <span class="badge bg-info text-white">Técnico</span>
                            </div>
                        </div>
                        <div class="list-group-item list-group-item-action p-3" onclick="selectQuickReply('escalado')">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1 fw-bold text-brand-blue">Escalado a Soporte</h6>
                                    <p class="mb-1 text-muted small">Tu caso ha sido escalado a nuestro equipo de soporte técnico especializado. Te contactarán en breve...</p>
                                </div>
                                <span class="badge bg-warning text-dark">Escalado</span>
                            </div>
                        </div>
                        <div class="list-group-item list-group-item-action p-3" onclick="selectQuickReply('resuelto')">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1 fw-bold text-brand-blue">Ticket Resuelto</h6>
                                    <p class="mb-1 text-muted small">Me alegra que hayamos podido resolver tu problema. Si tienes alguna otra consulta, no dudes en contactarnos...</p>
                                </div>
                                <span class="badge bg-success text-white">Cierre</span>
                            </div>
                        </div>
                        <div class="list-group-item list-group-item-action p-3" onclick="selectQuickReply('pago')">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1 fw-bold text-brand-blue">Problema de Pago</h6>
                                    <p class="mb-1 text-muted small">Entendemos tu preocupación respecto al pago. Hemos verificado en nuestro sistema y...</p>
                                </div>
                                <span class="badge bg-success text-white">Pagos</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-between">
                    <button type="button" class="btn btn-outline-primary rounded-pill px-4" data-bs-toggle="modal" data-bs-target="#newQuickReplyModal">
                        <i class="bi bi-plus-lg me-1"></i> Nueva Respuesta
                    </button>
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Crear Nueva Respuesta Predefinida -->
    <div class="modal fade" id="newQuickReplyModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-plus-circle me-2"></i>Nueva Respuesta Predefinida
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Título <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="newReplyTitle" placeholder="Ej: Saludo inicial">
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Categoría</label>
                        <select class="form-select" id="newReplyCategory">
                            <option value="general">General</option>
                            <option value="tecnico">Técnico</option>
                            <option value="pagos">Pagos</option>
                            <option value="seguimiento">Seguimiento</option>
                            <option value="cierre">Cierre</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold text-brand-blue">Contenido <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="newReplyContent" rows="5" placeholder="Escribe el contenido de la respuesta..."></textarea>
                        <small class="text-muted">Variables disponibles: $nombre, $operador, $ticket_id, $fecha</small>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary rounded-pill px-4" style="background: var(--brand-gradient); border: none;" onclick="saveQuickReply()">
                        <i class="bi bi-check-lg me-1"></i> Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Todas las Notificaciones -->
    <div class="modal fade" id="allNotificationsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0 shadow rounded-4">
                <div class="modal-header" style="background: linear-gradient(135deg, rgba(0, 101, 183, 0.05), rgba(0, 156, 180, 0.05));">
                    <h5 class="modal-title fw-bold title-gradient">
                        <i class="bi bi-bell-fill me-2"></i>Centro de Notificaciones
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- Filtros -->
                    <div class="p-3 border-bottom bg-light">
                        <div class="d-flex flex-wrap gap-2 align-items-center">
                            <span class="fw-semibold text-brand-dark me-2">Filtrar:</span>
                            <button class="btn btn-sm btn-primary rounded-pill active" data-filter="all" onclick="filterAllNotifications('all')">
                                Todas
                            </button>
                            <button class="btn btn-sm btn-outline-secondary rounded-pill" data-filter="unread" onclick="filterAllNotifications('unread')">
                                <i class="bi bi-circle-fill text-danger me-1" style="font-size: 6px; vertical-align: middle;"></i>No leídas
                            </button>
                            <button class="btn btn-sm btn-outline-secondary rounded-pill" data-filter="ticket" onclick="filterAllNotifications('ticket')">
                                <i class="bi bi-ticket-perforated me-1"></i>Tickets
                            </button>
                            <button class="btn btn-sm btn-outline-secondary rounded-pill" data-filter="system" onclick="filterAllNotifications('system')">
                                <i class="bi bi-gear me-1"></i>Sistema
                            </button>
                            <button class="btn btn-sm btn-outline-secondary rounded-pill" data-filter="alert" onclick="filterAllNotifications('alert')">
                                <i class="bi bi-exclamation-triangle me-1"></i>Alertas
                            </button>
                        </div>
                    </div>
                    
                    <!-- Lista de notificaciones -->
                    <div class="all-notifications-list" id="allNotificationsList" style="max-height: 400px; overflow-y: auto;">
                        <!-- Se llena dinámicamente -->
                    </div>
                    
                    <!-- Paginación -->
                    <div class="p-3 border-top d-flex justify-content-between align-items-center">
                        <span class="text-muted small" id="notificationsPagination">Mostrando 1-10 de 25</span>
                        <nav aria-label="Paginación de notificaciones">
                            <ul class="pagination pagination-sm mb-0">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" onclick="changeNotificationPage(-1)">
                                        <i class="bi bi-chevron-left"></i>
                                    </a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#" onclick="changeNotificationPage(1)">
                                        <i class="bi bi-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-between">
                    <button type="button" class="btn btn-outline-danger rounded-pill px-4" onclick="clearAllNotifications()">
                        <i class="bi bi-trash me-1"></i> Limpiar todas
                    </button>
                    <button type="button" class="btn btn-outline-primary rounded-pill px-4" onclick="markAllAsRead()">
                        <i class="bi bi-check-all me-1"></i> Marcar todas como leídas
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav d-md-none">
        <button class="mobile-nav-item active" type="button">
            <i class="bi bi-house-door-fill"></i>
            <span>Home</span>
        </button>
        <button class="mobile-nav-item" type="button">
            <i class="bi bi-chat-dots-fill"></i>
            <span>Tickets</span>
        </button>
        <button class="mobile-nav-item position-relative" type="button" data-bs-toggle="offcanvas" data-bs-target="#solicitudesOffcanvas" aria-controls="solicitudesOffcanvas">
            <i class="bi bi-inbox-fill"></i>
            <span>Solicitudes</span>
            <span class="mobile-nav-badge" id="solicitudesCounterMobile">3</span>
        </button>
        <button class="mobile-nav-item" type="button">
            <i class="bi bi-gear-fill"></i>
            <span>Config</span>
        </button>
    </nav>

    <!-- Floating Action Button (Mobile) -->
    <button class="fab d-md-none" id="fabButton">
        <i class="bi bi-plus-lg"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables globales
        let isMobile = window.innerWidth < 768;
        let selectedFiles = [];

        // Detectar cambios de tamaño
        window.addEventListener('resize', function() {
            isMobile = window.innerWidth < 768;
        });

        // Función para cambiar de pestaña
        function switchTab(tabName, clickedElement = null) {
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            const fab = document.querySelector('.fab');
            
            // Actualizar estado visual de los botones
            mobileNavItems.forEach(nav => nav.classList.remove('active'));
            if (clickedElement) clickedElement.classList.add('active');
            
            // Activar el tab de Bootstrap
            const tabElement = document.querySelector('#' + tabName + '-tab');
            if (tabElement) {
                const tab = new bootstrap.Tab(tabElement);
                tab.show();
            }
            
            // Mostrar FAB en Home y Tickets, ocultar en Config
            const fabButton = document.getElementById('fabButton');
            if (isMobile && fabButton) {
                if (tabName === 'home' || tabName === 'ticket') {
                    fabButton.style.display = 'flex';
                } else {
                    fabButton.style.display = 'none';
                }
            }
            
            // Si está en la pestaña de tickets en móvil, asegurar que se muestra la lista
            if (tabName === 'ticket' && isMobile) {
                const ticketsList = document.getElementById('mobileTicketsList');
                const chatContainer = document.getElementById('mobileChatContainer');
                const bottomNav = document.querySelector('.mobile-bottom-nav');
                
                if (ticketsList && chatContainer) {
                    ticketsList.classList.remove('d-none');
                    chatContainer.classList.add('d-none');
                    chatContainer.classList.remove('d-flex');
                }
                if (bottomNav) bottomNav.style.display = 'flex';
            }
        }

        // Sincronizar tabs móviles con tabs de escritorio
        document.addEventListener('DOMContentLoaded', function() {
            // Estado inicial: desktop muestra chat, móvil muestra lista
            const initialIsMobile = window.innerWidth < 768;
            const ticketsList = document.getElementById('mobileTicketsList');
            const chatContainer = document.getElementById('mobileChatContainer');
            const bottomNav = document.querySelector('.mobile-bottom-nav');

            if (!initialIsMobile) {
                if (chatContainer) {
                    chatContainer.classList.remove('d-none');
                    chatContainer.classList.add('d-flex');
                }
                if (ticketsList) ticketsList.classList.add('d-none');
                if (bottomNav) bottomNav.style.display = 'none';
            } else {
                if (chatContainer) {
                    chatContainer.classList.add('d-none');
                    chatContainer.classList.remove('d-flex');
                }
                if (ticketsList) ticketsList.classList.remove('d-none');
            }

            // Configurar event listeners para los botones de navegación móvil
            const mobileNavButtons = document.querySelectorAll('.mobile-nav-item');
            mobileNavButtons.forEach((button, index) => {
                // El botón índice 2 es Solicitudes (offcanvas), no necesita handler especial aquí
                // ya que usa data-bs-toggle="offcanvas"
                if (index === 2) return; // Solicitudes - manejado por Bootstrap
                
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Mapeo: 0=home, 1=ticket, 2=solicitudes(skip), 3=config
                    const tabs = ['home', 'ticket', null, 'config'];
                    const tabName = tabs[index];
                    
                    if (!tabName) return; // Si es null, no hacer nada
                    
                    // Actualizar estado visual (excepto el botón de solicitudes)
                    mobileNavButtons.forEach((btn, i) => {
                        if (i !== 2) btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Activar el tab de Bootstrap
                    const tabElement = document.querySelector('#' + tabName + '-tab');
                    if (tabElement) {
                        const tab = new bootstrap.Tab(tabElement);
                        tab.show();
                    }
                    
                    // Mostrar FAB en Home y Tickets, ocultar en Config
                    const fabButton = document.getElementById('fabButton');
                    if (fabButton) {
                        if (tabName === 'home' || tabName === 'ticket') {
                            fabButton.style.display = 'flex';
                        } else {
                            fabButton.style.display = 'none';
                        }
                    }
                    
                    // Si está en la pestaña de tickets en móvil, asegurar que se muestra la lista
                    if (tabName === 'ticket' && window.innerWidth < 768) {
                        const ticketsList = document.getElementById('mobileTicketsList');
                        const chatContainer = document.getElementById('mobileChatContainer');
                        const bottomNav = document.querySelector('.mobile-bottom-nav');
                        
                        if (ticketsList && chatContainer) {
                            ticketsList.classList.remove('d-none');
                            chatContainer.classList.add('d-none');
                            chatContainer.classList.remove('d-flex');
                        }
                        if (bottomNav) bottomNav.style.display = 'flex';
                    }
                }, { passive: false });
            });
            
            // Sincronizar cuando se cambia de tab desde desktop
            const tabElements = document.querySelectorAll('button[data-bs-toggle="tab"]');
            tabElements.forEach(tab => {
                tab.addEventListener('shown.bs.tab', function (event) {
                    const target = event.target.getAttribute('data-bs-target');
                    const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
                    // Mapeo: 0=home, 1=ticket, 2=solicitudes(skip), 3=config
                    const navTargets = { '#home': 0, '#ticket': 1, '#config': 3 };
                    
                    if (navTargets[target] !== undefined) {
                        mobileNavItems.forEach((nav, i) => {
                            if (i !== 2) nav.classList.remove('active'); // No tocar solicitudes
                        });
                        if (mobileNavItems[navTargets[target]]) {
                            mobileNavItems[navTargets[target]].classList.add('active');
                        }
                    }
                });
            });

            // Botón FAB para nuevo ticket
            const fabButton = document.getElementById('fabButton');
            if (fabButton) {
                fabButton.addEventListener('click', function() {
                    const newTicketModal = new bootstrap.Modal(document.getElementById('newTicketModal'));
                    newTicketModal.show();
                });
            }

            // Preview de archivos adjuntos con DataTransfer para poder eliminar
            const ticketAttachments = document.getElementById('ticketAttachments');
            if (ticketAttachments) {
                ticketAttachments.addEventListener('change', function(e) {
                    const files = Array.from(e.target.files);
                    selectedFiles = files;
                    updateAttachmentPreview();
                });
            }

            function updateAttachmentPreview() {
                const preview = document.getElementById('attachmentPreview');
                const list = document.getElementById('attachmentList');
                
                if (selectedFiles.length > 0) {
                    preview.style.display = 'block';
                    list.innerHTML = '';
                    
                    selectedFiles.forEach((file, index) => {
                        const fileSize = (file.size / 1024 / 1024).toFixed(2);
                        const fileIcon = getFileIcon(file.type);
                        
                        const container = document.createElement('div');
                        container.className = 'position-relative';
                        container.style.display = 'inline-block';
                        
                        const badge = document.createElement('div');
                        badge.className = 'badge bg-light text-dark border d-flex align-items-center gap-2 py-2 px-3 pe-4';
                        badge.innerHTML = `
                            <i class="bi ${fileIcon} text-primary"></i>
                            <div class="d-flex flex-column align-items-start">
                                <span class="text-truncate" style="max-width: 180px; font-weight: 500;">${file.name}</span>
                                <small class="text-muted" style="font-size: 0.7rem;">${fileSize} MB</small>
                            </div>
                        `;
                        
                        const deleteBtn = document.createElement('button');
                        deleteBtn.type = 'button';
                        deleteBtn.className = 'btn btn-sm p-0 position-absolute';
                        deleteBtn.style.cssText = 'right: 4px; top: 4px; width: 20px; height: 20px; border-radius: 50%; background: #dc3545; border: 2px solid white; color: white; display: flex; align-items: center; justify-content: center; line-height: 1; font-size: 12px;';
                        deleteBtn.innerHTML = '<i class="bi bi-x"></i>';
                        deleteBtn.title = 'Eliminar archivo';
                        deleteBtn.onclick = function() { removeAttachment(index); };
                        
                        container.appendChild(badge);
                        container.appendChild(deleteBtn);
                        list.appendChild(container);
                    });
                } else {
                    preview.style.display = 'none';
                }
            }

            function removeAttachment(index) {
                selectedFiles.splice(index, 1);
                
                // Actualizar el input file con los archivos restantes
                const dataTransfer = new DataTransfer();
                selectedFiles.forEach(file => {
                    dataTransfer.items.add(file);
                });
                document.getElementById('ticketAttachments').files = dataTransfer.files;
                
                updateAttachmentPreview();
            }
        });

        // Función auxiliar para obtener el icono según el tipo de archivo
        function getFileIcon(fileType) {
            if (fileType.startsWith('image/')) return 'bi-file-earmark-image';
            if (fileType.includes('pdf')) return 'bi-file-earmark-pdf';
            if (fileType.includes('word')) return 'bi-file-earmark-word';
            if (fileType.includes('excel') || fileType.includes('spreadsheet')) return 'bi-file-earmark-excel';
            if (fileType.includes('zip') || fileType.includes('rar')) return 'bi-file-earmark-zip';
            return 'bi-file-earmark';
        }

        // Función para crear el ticket
        function createTicket() {
            const form = document.getElementById('newTicketForm');
            
            // Validar formulario
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Recoger datos del formulario
            const ticketData = {
                subject: document.getElementById('ticketSubject').value,
                description: document.getElementById('ticketDescription').value,
                priority: document.getElementById('ticketPriority').value,
                category: document.getElementById('ticketCategory').value,
                user: document.getElementById('ticketUser').value || null,
                attachments: document.getElementById('ticketAttachments').files
            };

            // Aquí se implementaría la llamada AJAX al backend
            console.log('Creando ticket:', ticketData);

            // Simular creación exitosa
            const modal = bootstrap.Modal.getInstance(document.getElementById('newTicketModal'));
            modal.hide();

            // Limpiar formulario
            form.reset();
            selectedFiles = [];
            document.getElementById('attachmentPreview').style.display = 'none';

            // Mostrar notificación (puedes reemplazar con toast o alert personalizado)
            alert('¡Ticket creado exitosamente! Un operador te responderá pronto.');

            // Opcionalmente, cambiar a la pestaña de tickets
            if (isMobile) {
                switchTab('ticket');
            }
        }

        // Mostrar modal de filtros
        function showFiltersModal() {
            const filtersModal = new bootstrap.Modal(document.getElementById('filtersModal'));
            filtersModal.show();
        }

        // Aplicar filtros
        function applyFilters() {
            console.log('Aplicando filtros...');
            const filtersModal = bootstrap.Modal.getInstance(document.getElementById('filtersModal'));
            if (filtersModal) filtersModal.hide();
        }

        // Limpiar filtros
        function resetFilters() {
            document.querySelectorAll('.btn-check').forEach(check => {
                if (check.id !== 'filter-all') {
                    check.checked = false;
                }
            });
            const filterAll = document.getElementById('filter-all');
            if (filterAll) filterAll.checked = true;

            document.querySelectorAll('input[type="date"]').forEach(input => {
                input.value = '';
            });

            document.querySelectorAll('select').forEach(select => {
                select.selectedIndex = 0;
            });

            console.log('Filtros limpiados');
        }

        // Abrir chat individual en móvil
        function openMobileChat(ticketId) {
            if (!isMobile) return;
            
            const ticketsList = document.getElementById('mobileTicketsList');
            const chatContainer = document.getElementById('mobileChatContainer');
            const bottomNav = document.querySelector('.mobile-bottom-nav');
            const fab = document.querySelector('.fab');
            
            // Ocultar lista y mostrar chat
            ticketsList.classList.add('d-none');
            chatContainer.classList.remove('d-none');
            chatContainer.classList.add('d-flex');
            
            // Ocultar bottom nav y FAB cuando está en chat
            const fabButton = document.getElementById('fabButton');
            if (bottomNav) bottomNav.style.display = 'none';
            if (fabButton) fabButton.style.display = 'none';
            
            // Aquí se cargaría dinámicamente el contenido del ticket
            console.log('Abriendo chat móvil ticket:', ticketId);
        }

        // Cerrar chat y volver a lista en móvil
        function closeMobileChat() {
            const mobileNow = window.innerWidth < 768;
            if (!mobileNow) return;

            const ticketsList = document.getElementById('mobileTicketsList');
            const chatContainer = document.getElementById('mobileChatContainer');
            const bottomNav = document.querySelector('.mobile-bottom-nav');

            if (ticketsList) ticketsList.classList.remove('d-none');
            if (chatContainer) {
                chatContainer.classList.add('d-none');
                chatContainer.classList.remove('d-flex');
            }

            if (bottomNav) bottomNav.style.display = '';

            const fabButton = document.getElementById('fabButton');
            const activePane = document.querySelector('.tab-pane.show.active');
            const activeId = activePane ? activePane.id : null;
            if (fabButton) {
                fabButton.style.display = (activeId === 'home' || activeId === 'ticket') ? 'flex' : 'none';
            }
        }

        // Abrir ticket desde el sidebar
        function openTicketFromSidebar(ticketId, element = null) {
            // Activar la pestaña de tickets
            const ticketTab = document.getElementById('ticket-tab');
            if (ticketTab) {
                const tab = new bootstrap.Tab(ticketTab);
                tab.show();
            }

            // Remover clase active de todos los items del historial
            document.querySelectorAll('.ticket-history-item').forEach(item => {
                item.classList.remove('active');
            });

            // Agregar clase active al item clickeado
            if (element) {
                element.classList.add('active');
            }

            // En móvil, abrir el chat
            if (isMobile) {
                openMobileChat(ticketId);
            } else {
                const chatContainer = document.getElementById('mobileChatContainer');
                if (chatContainer) {
                    chatContainer.classList.remove('d-none');
                    chatContainer.classList.add('d-flex');
                }
            }

            console.log('Abriendo ticket desde sidebar:', ticketId);

            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                chatMessages.scrollTop = 0;
            }
        }

        // Búsqueda de tickets en tiempo real
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchTicketInput');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase().trim();
                    const searchResults = document.getElementById('searchResults');
                    
                    if (searchTerm === '') {
                        searchResults.innerHTML = `
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-search display-4 d-block mb-3 opacity-25"></i>
                                <p>Comienza a escribir para buscar tickets...</p>
                            </div>
                        `;
                        return;
                    }

                    // Simular búsqueda (aquí se haría una llamada AJAX al backend)
                    const allTickets = [
                        { id: '1001', subject: 'Problema con acceso', user: 'Juan Pérez', status: 'Pendiente', date: '11/12/2025' },
                        { id: '1002', subject: 'Ayuda con cuenta', user: 'Ana García', status: 'Abierto', date: '10/12/2025' },
                        { id: '1003', subject: 'Error en pagos', user: 'Carlos López', status: 'Cerrado', date: '09/12/2025' },
                        { id: '1004', subject: 'Consulta membresía', user: 'María Rodríguez', status: 'Pendiente', date: '08/12/2025' },
                        { id: '1005', subject: 'Reset password', user: 'Pedro Martínez', status: 'Abierto', date: '07/12/2025' },
                        { id: '1006', subject: 'Actualizar datos', user: 'Laura Sánchez', status: 'Pendiente', date: '06/12/2025' }
                    ];

                    const filteredTickets = allTickets.filter(ticket => 
                        ticket.id.toLowerCase().includes(searchTerm) ||
                        ticket.subject.toLowerCase().includes(searchTerm) ||
                        ticket.user.toLowerCase().includes(searchTerm) ||
                        ticket.status.toLowerCase().includes(searchTerm)
                    );

                    if (filteredTickets.length === 0) {
                        searchResults.innerHTML = `
                            <div class="text-center py-5 text-muted">
                                <i class="bi bi-inbox display-4 d-block mb-3 opacity-25"></i>
                                <p>No se encontraron tickets con "${searchTerm}"</p>
                            </div>
                        `;
                        return;
                    }

                    let resultsHTML = '<div class="list-group list-group-flush">';
                    filteredTickets.forEach(ticket => {
                        const statusBadge = ticket.status === 'Pendiente' ? 'bg-warning text-dark' : 
                                          ticket.status === 'Abierto' ? 'bg-primary' : 'bg-success';
                        
                        resultsHTML += `
                            <a href="#" class="list-group-item list-group-item-action" onclick="openTicketFromSearch('${ticket.id}'); return false;">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1 fw-bold text-brand-blue">#${ticket.id}</h6>
                                        <p class="mb-1">${ticket.subject}</p>
                                        <small class="text-muted">
                                            <i class="bi bi-person me-1"></i>${ticket.user}
                                            <i class="bi bi-calendar ms-2 me-1"></i>${ticket.date}
                                        </small>
                                    </div>
                                    <span class="badge ${statusBadge} ms-2">${ticket.status}</span>
                                </div>
                            </a>
                        `;
                    });
                    resultsHTML += '</div>';
                    
                    searchResults.innerHTML = resultsHTML;
                });
            }
        });

        // Abrir ticket desde búsqueda
        function openTicketFromSearch(ticketId) {
            // Cerrar el modal de búsqueda
            const searchModal = bootstrap.Modal.getInstance(document.getElementById('searchTicketsModal'));
            if (searchModal) {
                searchModal.hide();
            }

            // Abrir el ticket
            openTicketFromSidebar(ticketId);
            
            // Actualizar el estado active en el sidebar
            document.querySelectorAll('.ticket-history-item').forEach(item => {
                item.classList.remove('active');
                if (item.onclick && item.onclick.toString().includes(ticketId)) {
                    item.classList.add('active');
                }
            });
        }

        // Búsqueda en tiempo real para móvil
        document.addEventListener('DOMContentLoaded', function() {
            const mobileSearchInput = document.getElementById('mobileSearchInput');
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase().trim();
                    const ticketItems = document.querySelectorAll('#mobileTicketsList .tickets-list-item');
                    
                    ticketItems.forEach(item => {
                        const ticketTitle = item.querySelector('.ticket-title')?.textContent.toLowerCase() || '';
                        const ticketPreview = item.querySelector('.ticket-preview')?.textContent.toLowerCase() || '';
                        
                        if (ticketTitle.includes(searchTerm) || ticketPreview.includes(searchTerm)) {
                            item.style.display = '';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            }
        });

        // ========================================
        // GESTIÓN DE SOLICITUDES PENDIENTES
        // ========================================
        
        let solicitudActual = null; // Almacena el ID de la solicitud actual para modales

        // Datos de ejemplo para solicitudes (se reemplazará con llamadas AJAX)
        const solicitudesData = {
            '2001': {
                titulo: 'Sistema caído completamente',
                usuario: 'Roberto Méndez',
                email: 'roberto@email.com',
                prioridad: 'critica',
                categoria: 'Soporte Técnico',
                fecha: '12/12/2025, 10:30',
                descripcion: 'El sistema principal no está funcionando desde esta mañana. Ningún usuario puede acceder y estamos perdiendo operaciones importantes.\n\nYa intentamos reiniciar los servidores pero el problema persiste. Necesitamos asistencia urgente.',
                adjuntos: ['error_screenshot.png', 'logs.txt']
            },
            '2002': {
                titulo: 'No puedo procesar pagos',
                usuario: 'Carolina Vega',
                email: 'carolina@email.com',
                prioridad: 'alta',
                categoria: 'Pagos',
                fecha: '12/12/2025, 10:15',
                descripcion: 'Cuando intento realizar un pago el sistema muestra error 500. Adjunto captura de pantalla del problema.',
                adjuntos: ['pago_error.png']
            },
            '2003': {
                titulo: 'Actualizar datos de membresía',
                usuario: 'Luis Fernández',
                email: 'luis@email.com',
                prioridad: 'media',
                categoria: 'Membresía',
                fecha: '12/12/2025, 09:30',
                descripcion: 'Necesito cambiar mi dirección de correo electrónico asociada a mi cuenta de membresía premium.',
                adjuntos: []
            }
        };

        // Filtrar solicitudes por prioridad
        function filterSolicitudes(prioridad) {
            const cards = document.querySelectorAll('.solicitud-card');
            const buttons = document.querySelectorAll('#solicitudesOffcanvas .btn-sm');
            
            // Actualizar botones activos
            buttons.forEach(btn => btn.classList.remove('active', 'btn-primary'));
            event.target.classList.add('active', 'btn-primary');
            
            cards.forEach(card => {
                if (prioridad === 'todas' || card.dataset.prioridad === prioridad) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Aceptar solicitud
        function aceptarSolicitud(solicitudId) {
            // Mostrar confirmación breve
            if (confirm('¿Aceptar esta solicitud y crear el ticket?')) {
                procesarAceptacion(solicitudId);
            }
        }

        // Procesar aceptación
        function procesarAceptacion(solicitudId) {
            // Aquí se haría la llamada AJAX al backend
            console.log('Aceptando solicitud:', solicitudId);
            
            // Remover la card con animación
            const card = document.querySelector(`.solicitud-card[data-id="${solicitudId}"]`);
            if (card) {
                card.style.transition = 'all 0.3s ease';
                card.style.opacity = '0';
                card.style.transform = 'translateX(100%)';
                
                setTimeout(() => {
                    card.remove();
                    actualizarContadorSolicitudes();
                    
                    // Mostrar toast de éxito
                    mostrarToast('success', '¡Ticket creado exitosamente!', 'La solicitud ha sido aceptada y se ha creado el ticket.');
                }, 300);
            }
            
            // Cerrar modal si está abierto
            const detalleModal = bootstrap.Modal.getInstance(document.getElementById('detalleSolicitudModal'));
            if (detalleModal) detalleModal.hide();
        }

        // Rechazar solicitud
        function rechazarSolicitud(solicitudId) {
            solicitudActual = solicitudId;
            const rechazarModal = new bootstrap.Modal(document.getElementById('rechazarSolicitudModal'));
            rechazarModal.show();
        }

        // Confirmar rechazo
        function confirmarRechazo() {
            const motivo = document.getElementById('motivoRechazoSelect').value;
            const comentario = document.getElementById('comentarioRechazo').value;
            
            if (!motivo) {
                alert('Por favor selecciona un motivo de rechazo.');
                return;
            }
            
            // Aquí se haría la llamada AJAX al backend
            console.log('Rechazando solicitud:', solicitudActual, { motivo, comentario });
            
            // Cerrar modal de rechazo
            const rechazarModal = bootstrap.Modal.getInstance(document.getElementById('rechazarSolicitudModal'));
            rechazarModal.hide();
            
            // Remover la card con animación
            const card = document.querySelector(`.solicitud-card[data-id="${solicitudActual}"]`);
            if (card) {
                card.style.transition = 'all 0.3s ease';
                card.style.opacity = '0';
                card.style.transform = 'translateX(-100%)';
                
                setTimeout(() => {
                    card.remove();
                    actualizarContadorSolicitudes();
                    
                    // Limpiar formulario
                    document.getElementById('motivoRechazoSelect').value = '';
                    document.getElementById('comentarioRechazo').value = '';
                    solicitudActual = null;
                    
                    mostrarToast('info', 'Solicitud rechazada', 'Se ha notificado al usuario sobre el rechazo.');
                }, 300);
            }
            
            // Cerrar modal de detalle si está abierto
            const detalleModal = bootstrap.Modal.getInstance(document.getElementById('detalleSolicitudModal'));
            if (detalleModal) detalleModal.hide();
        }

        // Ver detalle de solicitud
        function verDetalleSolicitud(solicitudId) {
            solicitudActual = solicitudId;
            const data = solicitudesData[solicitudId];
            
            if (!data) {
                console.error('Solicitud no encontrada:', solicitudId);
                return;
            }
            
            // Llenar modal con datos
            document.getElementById('detalleSolicitudTitulo').textContent = data.titulo;
            document.getElementById('detalleSolicitudDescripcion').innerHTML = data.descripcion.replace(/\n/g, '<br>');
            document.getElementById('detalleSolicitudUsuario').textContent = data.usuario;
            document.getElementById('detalleSolicitudEmail').textContent = data.email;
            document.getElementById('detalleSolicitudCategoria').textContent = data.categoria;
            document.getElementById('detalleSolicitudFecha').textContent = data.fecha;
            
            // Prioridad con badge
            const prioridadBadge = document.getElementById('detalleSolicitudPrioridad');
            prioridadBadge.textContent = data.prioridad.charAt(0).toUpperCase() + data.prioridad.slice(1);
            prioridadBadge.className = 'badge prioridad-' + data.prioridad;
            
            // Adjuntos
            const adjuntosContainer = document.getElementById('detalleSolicitudAdjuntos');
            if (data.adjuntos && data.adjuntos.length > 0) {
                adjuntosContainer.style.display = '';
                const adjuntosHTML = data.adjuntos.map(adj => {
                    const icon = getFileIconByName(adj);
                    return `<div class="badge bg-light text-dark border p-2 d-flex align-items-center gap-2">
                        <i class="bi ${icon} text-primary"></i>
                        <span>${adj}</span>
                    </div>`;
                }).join('');
                adjuntosContainer.querySelector('.d-flex').innerHTML = adjuntosHTML;
            } else {
                adjuntosContainer.style.display = 'none';
            }
            
            // Mostrar modal
            const detalleModal = new bootstrap.Modal(document.getElementById('detalleSolicitudModal'));
            detalleModal.show();
        }

        // Funciones para acciones desde el modal de detalle
        function aceptarDesdeDetalle() {
            if (solicitudActual) {
                procesarAceptacion(solicitudActual);
            }
        }

        function rechazarDesdeDetalle() {
            // Cerrar modal de detalle primero
            const detalleModal = bootstrap.Modal.getInstance(document.getElementById('detalleSolicitudModal'));
            if (detalleModal) detalleModal.hide();
            
            // Abrir modal de rechazo
            setTimeout(() => {
                rechazarSolicitud(solicitudActual);
            }, 300);
        }

        // Actualizar contador de solicitudes
        function actualizarContadorSolicitudes() {
            const cards = document.querySelectorAll('.solicitud-card');
            const count = cards.length;
            
            // Actualizar todos los contadores
            document.getElementById('solicitudesCounterDesktop').textContent = count;
            document.getElementById('solicitudesCounterMobile').textContent = count;
            document.getElementById('solicitudesCount').textContent = count;
            
            // Mostrar/ocultar badges si es 0
            const desktopBadge = document.getElementById('solicitudesCounterDesktop');
            const mobileBadge = document.getElementById('solicitudesCounterMobile');
            
            if (count === 0) {
                desktopBadge.style.display = 'none';
                mobileBadge.style.display = 'none';
                document.getElementById('solicitudesEmpty').classList.remove('d-none');
                document.getElementById('solicitudesList').style.display = 'none';
            } else {
                desktopBadge.style.display = '';
                mobileBadge.style.display = '';
                document.getElementById('solicitudesEmpty').classList.add('d-none');
                document.getElementById('solicitudesList').style.display = '';
            }
        }

        // Actualizar lista de solicitudes (simular refresh)
        function actualizarSolicitudes() {
            const btn = event.target.closest('button');
            const icon = btn.querySelector('i');
            
            // Animar icono
            icon.classList.add('spin-animation');
            btn.disabled = true;
            
            // Simular carga
            setTimeout(() => {
                icon.classList.remove('spin-animation');
                btn.disabled = false;
                mostrarToast('info', 'Actualizado', 'Lista de solicitudes actualizada.');
            }, 1000);
            
            // Aquí se haría la llamada AJAX al backend para obtener nuevas solicitudes
            console.log('Actualizando solicitudes...');
        }

        // Helper para obtener icono por nombre de archivo
        function getFileIconByName(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const iconMap = {
                'png': 'bi-file-earmark-image',
                'jpg': 'bi-file-earmark-image',
                'jpeg': 'bi-file-earmark-image',
                'gif': 'bi-file-earmark-image',
                'pdf': 'bi-file-earmark-pdf',
                'doc': 'bi-file-earmark-word',
                'docx': 'bi-file-earmark-word',
                'xls': 'bi-file-earmark-excel',
                'xlsx': 'bi-file-earmark-excel',
                'txt': 'bi-file-earmark-text',
                'zip': 'bi-file-earmark-zip',
                'rar': 'bi-file-earmark-zip'
            };
            return iconMap[ext] || 'bi-file-earmark';
        }

        // Mostrar toast de notificación mejorado
        function mostrarToast(tipo, titulo, mensaje) {
            const toastContainer = document.getElementById('toastContainer');
            
            const icons = {
                success: 'bi-check-circle-fill',
                error: 'bi-x-circle-fill',
                warning: 'bi-exclamation-triangle-fill',
                info: 'bi-info-circle-fill'
            };
            
            const toastId = 'toast-' + Date.now();
            
            const toastHTML = `
                <div class="toast-custom ${tipo}" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-icon">
                        <i class="bi ${icons[tipo] || icons.info}"></i>
                    </div>
                    <div class="toast-content">
                        <div class="toast-title">${titulo}</div>
                        <div class="toast-message">${mensaje}</div>
                    </div>
                    <button class="toast-close" onclick="closeToast('${toastId}')" aria-label="Cerrar">
                        <i class="bi bi-x-lg"></i>
                    </button>
                    <div class="toast-progress"></div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            // Auto-remover después de 4 segundos
            setTimeout(() => {
                closeToast(toastId);
            }, 4000);
        }
        
        // Cerrar toast con animación
        function closeToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.classList.add('toast-exit');
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }
        }

        // Agregar estilos de animación para el spinner
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                .spin-animation {
                    animation: spin 1s linear infinite;
                }
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            </style>
        `);

        // ========================================
        // SISTEMA DE NOTIFICACIONES EN TIEMPO REAL
        // ========================================

        // Datos de ejemplo de notificaciones
        let notificationsData = [
            { id: 1, type: 'new-ticket', title: 'Nuevo ticket recibido', text: 'Juan Pérez creó el ticket #1005', time: 'Hace 2 min', unread: true },
            { id: 2, type: 'response', title: 'Nueva respuesta', text: 'María González respondió en #1001', time: 'Hace 5 min', unread: true },
            { id: 3, type: 'urgent', title: 'Ticket urgente', text: 'El ticket #1003 fue marcado como crítico', time: 'Hace 15 min', unread: true },
            { id: 4, type: 'assigned', title: 'Ticket asignado', text: 'Se te asignó el ticket #1006', time: 'Hace 30 min', unread: true },
            { id: 5, type: 'closed', title: 'Ticket cerrado', text: 'El ticket #998 fue cerrado', time: 'Hace 1 hora', unread: false }
        ];

        // Inicializar notificaciones
        document.addEventListener('DOMContentLoaded', function() {
            renderNotifications();
            
            // Simular notificaciones en tiempo real (cada 30 segundos)
            setInterval(simulateNewNotification, 30000);
        });

        // Renderizar notificaciones
        function renderNotifications() {
            const list = document.getElementById('notificationsList');
            const unreadCount = notificationsData.filter(n => n.unread).length;
            
            // Actualizar contadores
            document.getElementById('unreadCount').textContent = unreadCount;
            const desktopBadge = document.getElementById('notifBadgeDesktop');
            const mobileBadge = document.getElementById('notifBadgeMobile');
            
            if (desktopBadge) desktopBadge.textContent = unreadCount;
            if (mobileBadge) mobileBadge.textContent = unreadCount;
            
            // Ocultar badges si no hay notificaciones
            if (unreadCount === 0) {
                if (desktopBadge) desktopBadge.style.display = 'none';
                if (mobileBadge) mobileBadge.style.display = 'none';
            } else {
                if (desktopBadge) desktopBadge.style.display = 'flex';
                if (mobileBadge) mobileBadge.style.display = 'flex';
            }
            
            // Renderizar lista
            list.innerHTML = notificationsData.map(n => `
                <div class="notification-item ${n.unread ? 'unread' : ''}" onclick="handleNotificationClick(${n.id})">
                    <div class="notification-icon ${n.type}">
                        <i class="bi ${getNotificationIcon(n.type)}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${n.title}</div>
                        <div class="notification-text">${n.text}</div>
                        <div class="notification-time">${n.time}</div>
                    </div>
                </div>
            `).join('');
        }

        // Obtener icono según tipo de notificación
        function getNotificationIcon(type) {
            const icons = {
                'new-ticket': 'bi-ticket-fill',
                'response': 'bi-chat-dots-fill',
                'urgent': 'bi-exclamation-triangle-fill',
                'assigned': 'bi-person-fill-add',
                'closed': 'bi-check-circle-fill'
            };
            return icons[type] || 'bi-bell-fill';
        }

        // Toggle panel de notificaciones
        function toggleNotifications() {
            const panel = document.getElementById('notificationsPanel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }

        // Click en notificación
        function handleNotificationClick(id) {
            const notif = notificationsData.find(n => n.id === id);
            if (notif) {
                notif.unread = false;
                renderNotifications();
                // Aquí se navegaría al ticket correspondiente
                console.log('Navegando a notificación:', id);
            }
            toggleNotifications();
        }

        // Marcar todas como leídas
        function markAllAsRead() {
            notificationsData.forEach(n => n.unread = false);
            renderNotifications();
            // Si el modal está abierto, actualizar también
            const allNotificationsList = document.getElementById('allNotificationsList');
            if (allNotificationsList && allNotificationsList.innerHTML !== '') {
                renderAllNotifications();
            }
            mostrarToast('success', 'Notificaciones', 'Todas las notificaciones marcadas como leídas');
        }

        // Simular nueva notificación
        function simulateNewNotification() {
            const types = ['new-ticket', 'response', 'urgent', 'assigned'];
            const type = types[Math.floor(Math.random() * types.length)];
            const titles = {
                'new-ticket': 'Nuevo ticket recibido',
                'response': 'Nueva respuesta',
                'urgent': 'Ticket urgente',
                'assigned': 'Ticket asignado'
            };
            
            const newNotif = {
                id: Date.now(),
                type: type,
                title: titles[type],
                text: `Actividad en ticket #${1000 + Math.floor(Math.random() * 100)}`,
                time: 'Ahora',
                unread: true
            };
            
            notificationsData.unshift(newNotif);
            if (notificationsData.length > 10) notificationsData.pop();
            
            renderNotifications();
            playNotificationSound();
        }

        // Reproducir sonido de notificación
        function playNotificationSound() {
            // Se puede agregar un sonido aquí si el usuario lo tiene habilitado
            console.log('🔔 Nueva notificación');
        }

        // Ver todas las notificaciones
        function showAllNotifications() {
            toggleNotifications();
            renderAllNotifications();
            const modal = new bootstrap.Modal(document.getElementById('allNotificationsModal'));
            modal.show();
        }

        // Renderizar todas las notificaciones en el modal
        function renderAllNotifications(filter = 'all') {
            const list = document.getElementById('allNotificationsList');
            let filteredNotifications = [...notificationsData];
            
            // Aplicar filtro
            if (filter === 'unread') {
                filteredNotifications = filteredNotifications.filter(n => n.unread);
            } else if (filter === 'ticket') {
                filteredNotifications = filteredNotifications.filter(n => ['new-ticket', 'assigned', 'closed'].includes(n.type));
            } else if (filter === 'system') {
                filteredNotifications = filteredNotifications.filter(n => n.type === 'assigned');
            } else if (filter === 'alert') {
                filteredNotifications = filteredNotifications.filter(n => n.type === 'urgent');
            }
            
            if (filteredNotifications.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-5 text-muted">
                        <i class="bi bi-bell-slash fs-1 mb-3 d-block"></i>
                        <p class="mb-0">No hay notificaciones para mostrar</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = filteredNotifications.map(n => `
                <div class="notification-item ${n.unread ? 'unread' : ''}" onclick="handleNotificationClickFromModal(${n.id})" style="cursor: pointer; padding: 1rem; border-bottom: 1px solid rgba(0,0,0,0.05);">
                    <div class="d-flex align-items-start gap-3">
                        <div class="notification-icon ${n.type}" style="width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="bi ${getNotificationIcon(n.type)}"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="fw-semibold ${n.unread ? 'text-brand-dark' : 'text-muted'}">${n.title}</div>
                                    <div class="small ${n.unread ? 'text-dark' : 'text-muted'}">${n.text}</div>
                                </div>
                                ${n.unread ? '<span class="badge bg-danger rounded-pill" style="font-size: 0.65rem;">Nueva</span>' : ''}
                            </div>
                            <div class="text-muted small mt-1">
                                <i class="bi bi-clock me-1"></i>${n.time}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Actualizar paginación
            document.getElementById('notificationsPagination').textContent = 
                `Mostrando ${filteredNotifications.length} de ${notificationsData.length}`;
        }

        // Filtrar notificaciones en el modal
        function filterAllNotifications(filter) {
            // Actualizar botones activos
            document.querySelectorAll('#allNotificationsModal [data-filter]').forEach(btn => {
                btn.classList.remove('active', 'btn-primary');
                btn.classList.add('btn-outline-secondary');
            });
            const activeBtn = document.querySelector(`#allNotificationsModal [data-filter="${filter}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('btn-outline-secondary');
                activeBtn.classList.add('active', 'btn-primary');
            }
            
            renderAllNotifications(filter);
        }

        // Click en notificación desde el modal
        function handleNotificationClickFromModal(id) {
            const notif = notificationsData.find(n => n.id === id);
            if (notif) {
                notif.unread = false;
                renderNotifications();
                renderAllNotifications();
            }
            mostrarToast('info', 'Notificación', `Abriendo: ${notif.title}`);
        }

        // Limpiar todas las notificaciones
        function clearAllNotifications() {
            if (confirm('¿Estás seguro de que deseas eliminar todas las notificaciones?')) {
                notificationsData = [];
                renderNotifications();
                renderAllNotifications();
                mostrarToast('success', 'Notificaciones', 'Todas las notificaciones han sido eliminadas');
            }
        }

        // Cambiar página de notificaciones
        function changeNotificationPage(direction) {
            // Implementación de paginación si es necesaria
            console.log('Cambiar página:', direction);
        }

        // Cerrar panel al hacer click fuera
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('notificationsPanel');
            const isClickInside = panel.contains(e.target) || 
                                  e.target.closest('.notification-badge-btn');
            if (!isClickInside && panel.style.display === 'block') {
                panel.style.display = 'none';
            }
        });

        // ========================================
        // BASE DE CONOCIMIENTO
        // ========================================

        function openKBCategory(category) {
            const modal = new bootstrap.Modal(document.getElementById('knowledgeBaseModal'));
            modal.show();
            // Aquí se podría filtrar por categoría
            console.log('Abriendo categoría KB:', category);
        }

        function openKBArticle(articleId) {
            // Aquí se cargaría el artículo completo
            console.log('Abriendo artículo:', articleId);
            mostrarToast('info', 'Base de Conocimiento', 'Cargando artículo...');
        }

        // ========================================
        // HISTORIAL Y AUDITORÍA
        // ========================================

        // Datos de auditoría de ejemplo
        const auditData = {
            '1001': [
                { time: '12/12/2025, 10:30', action: 'Ticket creado', user: 'Juan Pérez', type: 'create', details: 'Asunto: Problema con acceso al sistema' },
                { time: '12/12/2025, 10:35', action: 'Ticket asignado', user: 'a María González', type: 'assign', details: 'Asignación automática' },
                { time: '12/12/2025, 10:45', action: 'Estado cambiado a "En Proceso"', user: 'María González', type: 'update', details: '' },
                { time: '12/12/2025, 11:00', action: 'Respuesta enviada', user: 'María González', type: 'update', details: 'Hola Juan, estamos revisando...' }
            ],
            '1002': [
                { time: '11/12/2025, 14:00', action: 'Ticket creado', user: 'Ana García', type: 'create', details: 'Asunto: Ayuda con cuenta' },
                { time: '11/12/2025, 14:30', action: 'Ticket asignado', user: 'a Carlos Ruiz', type: 'assign', details: '' }
            ],
            '1003': [
                { time: '10/12/2025, 09:00', action: 'Ticket creado', user: 'Carlos López', type: 'create', details: 'Asunto: Error en pagos' },
                { time: '10/12/2025, 09:05', action: 'Prioridad cambiada', user: 'Sistema', type: 'update', details: 'De Media a Crítica' }
            ],
            '1004': [
                { time: '09/12/2025, 16:00', action: 'Ticket creado', user: 'María Rodríguez', type: 'create', details: '' },
                { time: '09/12/2025, 17:00', action: 'Ticket cerrado', user: 'Ana Martínez', type: 'close', details: 'Resuelto satisfactoriamente' }
            ]
        };

        function showAuditHistory(ticketId) {
            document.getElementById('auditTicketId').textContent = '#' + ticketId;
            
            const timeline = document.getElementById('auditTimelineContent');
            const data = auditData[ticketId] || [];
            
            timeline.innerHTML = data.map(item => `
                <div class="audit-item action-${item.type}">
                    <div class="audit-time">${item.time}</div>
                    <div class="audit-action">${item.action}</div>
                    <div class="audit-user">por ${item.user}</div>
                    ${item.details ? `<div class="audit-details">${item.details}</div>` : ''}
                </div>
            `).join('');
            
            const modal = new bootstrap.Modal(document.getElementById('auditHistoryModal'));
            modal.show();
        }

        function exportAuditHistory() {
            mostrarToast('info', 'Exportando', 'El historial se descargará en breve...');
            console.log('Exportando historial de auditoría');
        }

        // ========================================
        // RESPUESTAS PREDEFINIDAS
        // ========================================

        // Datos de respuestas predefinidas
        const quickRepliesData = {
            'saludo': 'Hola $nombre, gracias por contactarnos. Mi nombre es $operador y estaré ayudándote con tu solicitud. ¿En qué puedo asistirte?',
            'seguimiento': 'Para poder ayudarte mejor, necesito que me proporciones la siguiente información:\n\n1. Tu nombre de usuario\n2. Una descripción detallada del problema\n3. Cualquier mensaje de error que hayas recibido',
            'password': 'Hemos enviado un enlace de recuperación a tu correo electrónico registrado. Por favor revisa tu bandeja de entrada y también la carpeta de spam. El enlace es válido por 24 horas.',
            'escalado': 'Tu caso ha sido escalado a nuestro equipo de soporte técnico especializado. Un experto se pondrá en contacto contigo en las próximas 2 horas.',
            'resuelto': 'Me alegra que hayamos podido resolver tu problema. Si tienes alguna otra consulta, no dudes en contactarnos. ¡Que tengas un excelente día! 😊',
            'pago': 'Entendemos tu preocupación respecto al pago. Hemos verificado en nuestro sistema y encontramos que la transacción fue procesada correctamente. Si tienes alguna duda adicional, con gusto te ayudamos.'
        };

        function toggleQuickReplies() {
            const panel = document.getElementById('quickRepliesInline');
            panel.classList.toggle('show');
        }

        function insertQuickReply(text) {
            const input = document.getElementById('chatMessageInput');
            input.value = text;
            input.focus();
            toggleQuickReplies();
        }

        function selectQuickReply(key) {
            const text = quickRepliesData[key] || '';
            // Reemplazar variables
            const finalText = text
                .replace('$nombre', 'Usuario')
                .replace('$operador', 'María')
                .replace('$ticket_id', '#1001')
                .replace('$fecha', new Date().toLocaleDateString());
            
            insertQuickReply(finalText);
            
            // Cerrar modal si está abierto
            const modal = bootstrap.Modal.getInstance(document.getElementById('quickRepliesModal'));
            if (modal) modal.hide();
        }

        function saveQuickReply() {
            const title = document.getElementById('newReplyTitle').value;
            const content = document.getElementById('newReplyContent').value;
            const category = document.getElementById('newReplyCategory').value;
            
            if (!title || !content) {
                alert('Por favor completa todos los campos requeridos.');
                return;
            }
            
            // Aquí se guardaría en el backend
            console.log('Guardando respuesta:', { title, content, category });
            
            // Cerrar modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('newQuickReplyModal'));
            if (modal) modal.hide();
            
            // Limpiar formulario
            document.getElementById('newReplyTitle').value = '';
            document.getElementById('newReplyContent').value = '';
            
            mostrarToast('success', 'Guardado', 'Respuesta predefinida creada exitosamente');
        }

        function sendChatMessage() {
            const input = document.getElementById('chatMessageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Aquí se enviaría el mensaje al backend
            console.log('Enviando mensaje:', message);
            
            // Simular mensaje enviado
            const chatMessages = document.getElementById('chatMessages');
            const now = new Date();
            const time = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            
            const msgHTML = `
                <div class="message-wrapper user-message">
                    <div class="message-content">
                        <div class="message-bubble">
                            <p class="mb-0">${message}</p>
                        </div>
                        <small class="message-time">${time}</small>
                    </div>
                </div>
            `;
            
            chatMessages.insertAdjacentHTML('beforeend', msgHTML);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Limpiar input
            input.value = '';
        }

        // Enviar mensaje con Enter
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatMessageInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendChatMessage();
                    }
                });
            }
            
            // Cargar tema guardado
            loadSavedTheme();
        });

        // ============================================
        // SISTEMA DE TEMAS (Dark Mode)
        // ============================================
        
        function changeTheme(theme) {
            if (theme === 'auto') {
                // Detectar preferencia del sistema
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
            
            // Guardar preferencia
            localStorage.setItem('theme', theme);
            
            mostrarToast('success', 'Tema actualizado', `Tema ${theme === 'dark' ? 'oscuro' : theme === 'light' ? 'claro' : 'automático'} aplicado`);
        }
        
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const themeSelector = document.getElementById('themeSelector');
            
            if (themeSelector) {
                themeSelector.value = savedTheme;
            }
            
            if (savedTheme === 'auto') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
            } else {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        }
        
        // Escuchar cambios en la preferencia del sistema
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'auto') {
                document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
            }
        });

        // ============================================
        // MODALES DE CONFIRMACIÓN
        // ============================================
        
        function showConfirmModal(options) {
            const { type = 'warning', title, message, confirmText = 'Confirmar', cancelText = 'Cancelar', onConfirm } = options;
            
            const icons = {
                warning: 'bi-exclamation-triangle-fill',
                danger: 'bi-x-circle-fill',
                success: 'bi-check-circle-fill',
                info: 'bi-info-circle-fill'
            };
            
            const confirmBtnClass = type === 'danger' ? 'btn-danger' : 'btn-primary';
            
            const modalHTML = `
                <div class="modal fade confirm-modal" id="confirmModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-sm">
                        <div class="modal-content border-0 shadow">
                            <div class="modal-body">
                                <div class="confirm-icon ${type}">
                                    <i class="bi ${icons[type]}"></i>
                                </div>
                                <h5 class="confirm-title">${title}</h5>
                                <p class="confirm-message">${message}</p>
                                <div class="confirm-actions">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">${cancelText}</button>
                                    <button type="button" class="btn ${confirmBtnClass}" id="confirmModalBtn">${confirmText}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal anterior si existe
            const existingModal = document.getElementById('confirmModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            const modalElement = document.getElementById('confirmModal');
            const modal = new bootstrap.Modal(modalElement);
            
            document.getElementById('confirmModalBtn').addEventListener('click', function() {
                modal.hide();
                if (onConfirm) onConfirm();
            });
            
            modalElement.addEventListener('hidden.bs.modal', function() {
                modalElement.remove();
            });
            
            modal.show();
        }

        // ============================================
        // SKELETON LOADERS
        // ============================================
        
        function showSkeletonLoader(containerId, count = 3) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            let skeletonHTML = '';
            for (let i = 0; i < count; i++) {
                skeletonHTML += `
                    <div class="skeleton-card mb-3">
                        <div class="d-flex align-items-center">
                            <div class="skeleton skeleton-icon me-3"></div>
                            <div class="flex-grow-1">
                                <div class="skeleton skeleton-title"></div>
                                <div class="skeleton skeleton-value"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = skeletonHTML;
        }
        
        function hideSkeletonLoader(containerId, content) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = content;
        }

        // ============================================
        // EMPTY STATES
        // ============================================
        
        function showEmptyState(containerId, options) {
            const { icon = 'bi-inbox', title = 'No hay datos', message = '', actionText = '', onAction = null } = options;
            
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const actionButton = actionText ? `<button class="empty-state-action btn-ripple" onclick="${onAction}">${actionText}</button>` : '';
            
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="bi ${icon}"></i>
                    </div>
                    <h5 class="empty-state-title">${title}</h5>
                    <p class="empty-state-text">${message}</p>
                    ${actionButton}
                </div>
            `;
        }
    </script>
</body>
</html>